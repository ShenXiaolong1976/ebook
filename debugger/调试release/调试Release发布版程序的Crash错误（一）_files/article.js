if(typeof Sina=='undefined'){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=(levels[0]=="Sina")?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}else{}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $G(){}function $G2(){}function v5SendLog(){}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}
(function(){var funcName="trace";var _traceList=[];var _startTime=new Date().valueOf();var _curTime=new Date().valueOf();var _runTime;var _trace=function(sText,oOption,sBgColor){oOption=oOption||{};if(typeof oOption=="string"){oOption={"color":oOption};if(typeof sBgColor!="undefined"&&typeof sBgColor=="string"){oOption.bgColor=sBgColor}}_traceList[_traceList.length]=[sText,oOption]};var _traceError=function(oError){_trace(oError,{"color":"#F00"})};_trace.error=_traceError;_trace.traceList=_traceList;_trace.toString=function(){return"Trace调试已关闭"};window[funcName]=_trace;window.traceError=_traceError})();
Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}
Sina.pkg("Core.Array");
Core.Array.each=function(ar,insp){var r=[];for(var i=0;i<ar.length;i++){var x=insp(ar[i],i);if(x!==null){r.push(x)}}return r};
function Jobs(){this._jobTable=[]}Jobs.prototype={_registedJobTable:{},initialize:function(){},_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},add:function(jobName){this._jobTable.push(jobName)},start:function(){var jobs=this._jobTable;var regJobs=this._registedJobTable;var i=0;var joblen=this._jobTable.length;var getTime=function(){return new Date().valueOf()};var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=='undefined'){trace("<b>Job["+jobName+"] is undefiend!!!</b>",{"color":"#900","bgColor":"#FFF;"});return}var _try=true;var _start=getTime();try{job.call()}catch(e){trace("<b>Job["+jobName+"] failed!!!</b>",{"color":"#900","bgColor":"#666;"});traceError(e);_try=false}finally{if(_try){var _end=getTime();trace("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>",{"color":"#0F0","bgColor":"#666;"})}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{"color":"#900","bgColor":"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};
if(typeof App=='undefined'){var App={}}
Sina.pkg("Module");if(typeof Module=="undefined"){Module=Sina.Module}
Sina.pkg("Core.Events");
Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=$E(elm);if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=='undefined'){useCapture=false}if(typeof evType=='undefined'){evType='click'}if(_el.addEventListener){_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent('on'+evType,func);return true}else{_el['on'+evType]=func}};
Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=='undefined'){sName='click'}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};
Sina.pkg("Core.Base");
﻿(function(){var Detect=function(){var ua=navigator.userAgent.toLowerCase();this.$IE=/msie/.test(ua);this.$OPERA=/opera/.test(ua);this.$MOZ=/gecko/.test(ua);this.$IE5=/msie 5 /.test(ua);this.$IE55=/msie 5.5/.test(ua);this.$IE6=/msie 6/.test(ua);this.$IE7=/msie 7/.test(ua);this.$SAFARI=/safari/.test(ua);this.$winXP=/windows nt 5.1/.test(ua);this.$winVista=/windows nt 6.0/.test(ua);this.$FF2=/Firefox\/2/i.test(ua)};Core.Base.detect=new Detect()})();
Core.Events.getEvent=function(){return window.event};if(!Core.Base.detect.$IE){Core.Events.getEvent=function(){if(window.event)return window.event;var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}
Core.Events.fixEvent=function(e){if(typeof e=='undefined')e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=='undefined')e.layerX=e.offsetX;if(typeof e.layerY=='undefined')e.layerY=e.offsetY;return e};
Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();ev.cancelBubble=true;ev.returnValue=false};if(!$IE){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();ev.preventDefault();ev.stopPropagation()}}
Sina.pkg("Core.Dom");
Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(el.offsetParent){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};
Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(el.offsetParent){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};
Sina.pkg("Core.System");
Core.System.winSize=function(_target){var w,h;if(_target){target=_target.document}else{target=document}if(self.innerHeight){if(_target){target=_target.self}else{target=self}w=target.innerWidth;h=target.innerHeight}else if(target.documentElement&&target.documentElement.clientHeight){w=target.documentElement.clientWidth;h=target.documentElement.clientHeight}else if(target.body){w=target.body.clientWidth;h=target.body.clientHeight}return{width:w,height:h}};
Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};
Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}
Sina.pkg("Core.Function");
Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};
Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};
Utils.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Utils.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};
Module.FloatMenu={_n:null,_init:null,_init_:function(){if(this._init)return;this._n=document.body.appendChild($C('div'));this._n.className='CP_oper';this._n.style['position']='absolute';this._n.style['zIndex']='1000';this._n.id='Sina_Module_DrogDownList_Box';this._n.innerHTML='<ul></ul>';Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(e.button==2)return;Module.FloatMenu.hideItem()},'click');this._init=true},init:function(tar,data,pos){this._init_();scope.$floatmenu=this;Core.Events.addEvent(tar,function(){Core.Events.stopEvent();Module.FloatMenu.showItem(tar,data,pos)},'click')},showItem:function(tar,data,pos){this._n.style['visibility']='hidden';this._n.style['display']='block';this.buildList(data);var x=Core.Dom.getLeft(tar);var y=Core.Dom.getTop(tar);var w=tar.offsetWidth;var h=tar.offsetHeight;var n_w=this._n.offsetWidth;var n_h=this._n.offsetHeight;var dx,dy;var m=2;var win=Core.System.winSize();var scroll=Core.System.getScrollPos();if(pos=='R'){dy=y;dx=x+w+m}else{dx=x;dy=y+h+m}if((dx+n_w)>=win.w){dx=x-n_w-m}if((dy+n_h)>scroll[0]+win.h){dy=y-n_h+h}this._n.style['top']=dy+'px';this._n.style['left']=dx+'px';this._n.style['visibility']='visible'},hideItem:function(){this._n.style['display']='none'},buildList:function(data){this._n.firstChild.innerHTML='';var _tpl_href=new Utils.Template('<li><a href="#{href}" #{action}>#{label}</a></li>');var _tpl_label=new Utils.Template('<li><em>#{label}</em></li>');var str='';for(var i=0;i<data.length;i++){if(data[i]['href']||data[i]['action'])str+=_tpl_href.evaluate(data[i]);else str+=_tpl_label.evaluate(data[i])}this._n.firstChild.innerHTML=str}};
Sina.pkg('Utils.Io');
(function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.Base.parseParam=parseParam})();
Sina.pkg("Core.String");
Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof(name)!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):(forceSharp?"#":"")}};
Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};
Utils.Io.JsLoad={};(function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js[Core.Base.detect.$IE?"onreadystatechange":"onload"]=function(){if(Core.Base.detect.$MOZ||this.readyState.toLowerCase()=='complete'||this.readyState.toLowerCase()=='loaded'){oCFG.script_loaded_num++}};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=parseInt(Math.random()*100000000);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={urls:[],charset:"utf-8",noreturn:false,noencode:true,timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[]};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.Base.parseParam(_opts,oOpts);createScripts(_opts,_cfg);(function(){if(_opts.noreturn==true&&_opts.onComplete==null)return;var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)})();if(_opts.timeout>0){setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}})();
$SYSMSG.extend({"A00001":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A00002":"此帐号暂时被封，如有疑问也可联系新浪客服：致电95105670。","A00003":"无权限进行此操作，请重新登录。","A00004":"无权限进行此操作，请重新登录。","A00005":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A00006":"成功了","A00007":"无权限进行此操作，请重新登录。"});
$SYSMSG.extend({"A10200":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。"});
Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;
Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};
Core.Array.uniq=function(ar){var result=[];for(var i=0;i<ar.length;i++){var x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};
Utils.Uic={_interface:"http://uic.sinajs.cn/uic?type=nick",cacheNickName:{},getNickName:function(arrUidLists,fCallBack,requestNo){arrUidLists=Core.Array.uniq(arrUidLists)||[];requestNo=requestNo||10;var _cache=this.cacheNickName,_uidWithNoCache=[];var _data={};for(var i=0,len=arrUidLists.length;i<len;i++){if(typeof _cache[arrUidLists[i]]=="undefined"&&_cache[arrUidLists[i]]==null){_uidWithNoCache.push(arrUidLists[i])}else{_data[arrUidLists[i]]=_cache[arrUidLists[i]]||arrUidLists[i]}}if(_uidWithNoCache.length==0){fCallBack(_data);_data=null}else{var urls=[];while(_uidWithNoCache.length>0){urls.push({"url":this._interface+"&uids="+_uidWithNoCache.splice(0,requestNo).join(",")})}var jsRequest=function(aUrl){Utils.Io.JsLoad.request(aUrl[0].url,{onComplete:function(data){if(typeof data.length=="undefined"){for(var key in data){_data[key]=(data[key]||key)}fCallBack(_data)}else{for(var j=0;j<data.length;j++){for(var _item in data[j]){_data[_item]=(data[j][_item]||_item)}}fCallBack(_data)}}});if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}};if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}}}};
Module.setNick={isWokding:0,get:function(callBack){var callBack=callBack||function(){};if((this.isWokding!=0&&this.isWokding<10)&&!scope.nick){setTimeout(Core.Function.bind3(this.get,this,[callBack]),1000);this.isWokding++;return}var _this=this;this.isWokding=1;if(scope.nick){_this.isWokding=0;callBack()}else{Utils.Uic.getNickName([scope.$uid],function(result){scope.nick=result;_this.isWokding=0;callBack()})}}};
Module.Nav={_elementNick:null,_elementIcon:null,_isFriend:null,This:this,init:function(){var productUrl={blog:"http://blog.sina.com.cn/u/",photo:"http://photo.sina.com.cn/u/",music:"http://music.sina.com.cn/m/",vblog:"http://you.video.sina.com.cn/m/"};trace("begin nav");_elementNick=$E("nav_name");_elementIcon=$E("nav_icon");if(_elementNick){Module.setNick.get(function(){if(scope.nick[scope.$uid]!=null&&scope.nick[scope.$uid]!=""){_elementNick.innerHTML=scope.nick[scope.$uid]}else{_elementNick.innerHTML=scope.$uid}})}var userhead=Core.Dom.getElementsByClass($E("headpic100"),"div","userhead");var productAlt={blog:"博客个人首页",photo:"相册个人首页",music:"音乐个人首页",vblog:"播客个人首页",icp:"个人中心首页",tiezi:"帖子页"};if(userhead.length>0){Module.setNick.get(function(){var imgobj=userhead[0].getElementsByTagName('img')[0];imgobj.title="返回"+(scope.nick[scope.$uid]||scope.$uid)+"的"+productAlt[scope.$PRODUCT_NAME];imgobj.alt="返回"+(scope.nick[scope.$uid]||scope.$uid)+"的"+productAlt[scope.$PRODUCT_NAME]})}var productMap={202:"blog",203:"photo",204:"vblog",1224:"music"};option={onComplete:function(txt){trace("txt.retcode="+txt.RetCode);if(txt.RetCode=="0"){scope.$online_update=txt;var resultArr=txt.UserInfos;for(var i=0;i<resultArr.length;i++){trace(resultArr[i][0]);if(resultArr[i][1]==1){trace(">>>>>>>>>>>>>>>"+productMap[resultArr[i][0]]);objEm=document.createElement("em");if($E("nav_"+productMap[resultArr[i][0]]))$E("nav_"+productMap[resultArr[i][0]]).appendChild(objEm)}}}},onException:function(txt,txt2){trace(txt+";")}};Utils.Io.JsLoad.request("http://online2.sso.sina.com.cn/status/Query.php?UID="+scope.$uid+"&ProductType=0&Check="+scope.$key+"&ProductVersion=1.0&entry=platform",option)}};$registJob("nav",Module.Nav.init);
Sina.pkg("Module.Login");
Sina.pkg("Core.Class");
Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};
Utils.Drag2={init:function(_root,_handle){var o=this;var blk=_root;blk.hdl=_handle;if(typeof blk.hdl=='undefined'||typeof _handle==undefined)blk.hdl=blk;blk.hdl.onmousedown=start;blk.onDragStart=new Function();blk.onDrag=new Function();blk.onDragEnd=new Function();function start(e){e=e||event;var src=e.target||e.srcElement;if(src.tagName.toUpperCase()=="A"||src.parentNode.tagName.toUpperCase()=="A")return;var o=Utils.Drag2;v=blk;v.onDragStart();v.oX=o.getX(e);v.oY=o.getY(e);v.depth=v.style.zIndex;v.style.zIndex=1000000;v.rL=parseInt(v.style.left?v.style.left:0);v.rT=parseInt(v.style.top?v.style.top:0);document.onmousemove=drag;document.onmouseup=end;return false};function drag(e){var o=Utils.Drag2;var v=blk;var nX=o.getX(e);var nY=o.getY(e);var ll=v.rL+nX-v.oX;var tt=v.rT+nY-v.oY;v.style.left=ll+'px';v.style.top=tt+'px';v.onDrag(ll,tt);return false};function end(){v.style.zIndex=v.depth;document.onmousemove=null;document.onmouseup=null;v.onDragEnd()}},fixE:function(e){if(typeof e=='undefined')e=window.event;if(typeof e.layerX=='undefined')e.layerX=e.offsetX;if(typeof e.layerY=='undefined')e.layerY=e.offsetY;return e},getX:function(e){return this.fixE(e).clientX},getY:function(e){return this.fixE(e).clientY}};
Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+(val*100)+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!Core.Base.detect.$IE){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}
(function(){var toStyleAttribute=function(styleName){var arr=styleName.split('-');var cc=arr[0];for(var i=1;i<arr.length;i++){cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}return cc};Core.Dom.setStyle2=function(elem,style){if(typeof elem=='string'){elem=$E(elem)}for(var name in style){styleAttr=toStyleAttribute(name);Core.Dom.setStyle(elem,styleAttr,style[name])}}})();
Utils.Resize=function(){var blk=this;window.onresize=start;function start(){blk.onresize()};function end(){document.onresize=null}};
Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters['DXImageTransform.Microsoft.Alpha'].opacity}catch(e){try{val=el.filters('alpha').opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return(el.style[property]||value)}};if(!Core.Base.detect.$IE){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}
Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if(scope.$SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if(scope.$SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}
Core.Dom.setXY=function(el,pos,noRetry){var pos_style=Core.Dom.getStyle(el,"position");if(pos_style=="static"){Core.Dom.setStyle(el,"position","relative");pos_style="relative"}var page_xy=Core.Dom.getXY(el);if(page_xy==false){return false}var delta=[parseInt(Core.Dom.getStyle(el,"left"),10),parseInt(Core.Dom.getStyle(el,"top"),10)];if(isNaN(delta[0])){delta[0]=(pos_style=="relative")?0:el.offsetLeft}if(isNaN(delta[1])){delta[1]=(pos_style=="relative")?0:el.offsetTop}if(pos[0]!=null){el.style.left=pos[0]-page_xy[0]+delta[0]+"px"}if(pos[1]!=null){el.style.top=pos[1]-page_xy[1]+delta[1]+"px"}return true};
Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("BeforeEnd",sHTML)};if(!$IE){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}
Core.System.pageSize=function(_target){if(_target){target=_target.document}else{target=document}var _rootEl=(target.compatMode=="CSS1Compat"?target.documentElement:target.body);var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=_rootEl.scrollWidth;yScroll=window.innerHeight+window.scrollMaxY}else if(_rootEl.scrollHeight>_rootEl.offsetHeight){xScroll=_rootEl.scrollWidth;yScroll=_rootEl.scrollHeight}else{xScroll=_rootEl.offsetWidth;yScroll=_rootEl.offsetHeight}var win_s=Core.System.winSize(_target);if(yScroll<win_s.height){pageHeight=win_s.height}else{pageHeight=yScroll}if(xScroll<win_s.width){pageWidth=win_s.width}else{pageWidth=xScroll}return[pageWidth,pageHeight,win_s.width,win_s.height]};
Sina.Utils.dialog=function(oInitCFG,oInitFUNC,fixId){this._dialogCFG={ad:true,title:"未标题",drag:true,zindex:1024,shadow:1,fixed:false,css:"Dialog",content:"",middle:true,width:300,height:300,close:true,closed:true,resizable:true};this._dialogFUNC={onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onContentUpdate:function(){},onPosUpdate:function(){},onShow:function(){},onHidden:function(){}};for(var key in this._dialogCFG){if(oInitCFG[key]!=null){this._dialogCFG[key]=oInitCFG[key]}}for(key in this._dialogFUNC){if(oInitFUNC[key]!=null){this._dialogFUNC[key]=oInitFUNC[key]}}if(!$E("dialogParent")){Core.Dom.addHTML(document.body,'<div id="dialogParent" style="z-index:'+this._dialogCFG["zindex"]+'"></div>')}var ran=parseInt(Math.random()*10000);if(fixId){ran=fixId}this.id="dialog_"+ran;if($E(this.id)==null){var struc='<span  id="'+this.id+'"><div class="shadow"><iframe class="base" style="position:absolute;"></iframe><div class="base"></div></div><table class="CP_w"><thead><tr><th><strong></strong><cite><a href="javascript:;" class="CP_w_help" target="_blank">帮助</a><a href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite></th></tr></thead><tbody><tr><td style="vertical-align:top;"></td></tr></tbody></table></span>';Core.Dom.addHTML($E("dialogParent"),struc);this.initDom();this.__help.style.display="none";this.__body.style.position="absolute";this.setTitle(this._dialogCFG["title"]);this.setContent(this._dialogCFG["content"]);if(this._dialogCFG["middle"]){this.setMiddle()}if(this._dialogCFG["drag"]){Utils.Drag2.init(this.__body,this.__move);this.__move.style.cursor="move"}if(this._dialogCFG["close"]){this.__close.style.display="block";Core.Events.addEvent(this.__close,function(){this.hidden()}.bind2(this))}this.setShadow()}if(this._dialogCFG["resizable"])Utils.Resize.apply(this)};Sina.Utils.dialog.prototype={setIframe:function(oCFG){this.__content.style.background="url(http://blogimg.sinajs.cn/v5images/icon/loading.gif) center center no-repeat";var sURL=oCFG.url?oCFG.url:"http://control.blog.sina.com.cn/admin/ria/blank.html";sURL=sURL.split("//").length<2?("http://"+window.location.host+"/"+sURL):sURL;var nWidth=oCFG.width?oCFG.width:300;var nHeight=oCFG.height?oCFG.height:300;var bHost=sURL.split("//")[1].split("/")[0]==window.location.host;setTimeout(function(){this.setContent("<iframe id='DataIframe_"+this.id+"' frameborder='0' scrolling='no' style='width: "+nWidth+"px; height: "+nHeight+"px; "+(bHost?"display: none;":"")+"' src='"+sURL+"'></iframe>");Core.Events.addEvent($E("DataIframe_"+this.id),function(){$E("DataIframe_"+this.id).style.display="";this.__content.style.backgroundImage="url()"}.bind2(this),"load")}.bind2(this),1)},getCloseBtn:function(){return this.__close},setCloseBtn:function(oView){Core.Dom.setStyle(this.__close,"display",(oView==true?"":"none"))},show:function(){Core.Dom.setStyle(this.__dialog,"display","");Core.Dom.setStyle(this.__dialog,"visibility","visible");this._dialogFUNC.onShow();if(this._dialogCFG["fixed"]==true){this.setFixed()}},hidden:function(){if(this._dialogCFG.closed==false){this._dialogFUNC.onHidden();return}Core.Dom.setStyle(this.__dialog,"visibility","hidden");Core.Dom.setStyle(this.__dialog,"display","none");if(this._dialogCFG["fixed"]==true){this.clearFixed()}this._dialogFUNC.onHidden()},setWidth:function(w){try{this.__content.style.width=w+"px";if($E("DataIframe_"+this.id)){$E("DataIframe_"+this.id).style.width=w+"px"}}catch(e){traceError(e)}},getWidth:function(){try{return parseInt(this.__content.offsetWidth)}catch(e){return null}},setHeight:function(h){if($IE6){h+=h%2}this.__content.style.height=h+"px";if($E("DataIframe_"+this.id)){$E("DataIframe_"+this.id).style.height=h+"px"}},setSize:function(w,h){this.setWidth(w);this.setHeight(h);this._content_size=[w,h]},setContent:function(html){if(typeof html=="string"){this.__content.innerHTML=html}else{if(typeof html=="object"){this.__content.appendChild(html)}}this._dialogFUNC.onContentUpdate()},setPosition:function(nLeft,nTop){if(nLeft!=null){Core.Dom.setStyle(this.__body,"left",nLeft+"px")}if(nTop!=null){Core.Dom.setStyle(this.__body,"top",nTop+"px")}this._dialogFUNC.onPosUpdate()},setHelp:function(href,name){this.__help.style.display="block";if(arguments.length>1){this.__help.innerHTML=name}this.__help.href=href},setMiddle:function(){var thisw=this._dialogCFG.width;var thish=this._dialogCFG.height;var pageSize=Core.System.pageSize();var dialogTop=(pageSize[3]-thish)/2+Core.System.getScrollPos()[0];this._dialogInfo.left=(pageSize[2]-thisw)/2;this._dialogInfo.top=dialogTop<0?0:dialogTop;this.setPosition(this._dialogInfo.left,this._dialogInfo.top)},_dialogInfo:{},initDom:function(){this.__dialog=$E(this.id);this.__shadow=Core.Dom.getElementsByClass(this.__dialog,"div","shadow")[0];this.__body=Core.Dom.getElementsByClass(this.__dialog,"table","CP_w")[0];this.__title=Core.Dom.getElementsByClass(this.__body,"strong","")[0];this.__help=Core.Dom.getElementsByClass(this.__body,"a","CP_w_help")[0];this.__close=Core.Dom.getElementsByClass(this.__body,"a","CP_w_shut")[0];this.__content=Core.Dom.getElementsByClass(this.__body,"td","")[0];this.__move=Core.Dom.getElementsByClass(this.__body,"thead","")[0]},setTitle:function(title){this.__title.innerHTML=title||""},setCloseEvent:function(bClose){this._dialogCFG.closed=bClose},getDialogNodes:function(){return this.__close},getDialogBody:function(){return this.__body},setShadow:function(){if(this._dialogCFG["shadow"]==0){return}var this_shadow=this.__shadow;var pageSize=Core.System.pageSize();if(typeof(this._dialogCFG["top"])!='undefined'){pageSize[1]-=this._dialogCFG["top"]}var shdowHeight=pageSize[3];Core.Dom.setStyle(this_shadow,"display","block");if(pageSize[1]>pageSize[3]&&scope.$MOZ){Core.Dom.setStyle(this_shadow,"width",(pageSize[0]-18)+"px")}else{if(scope.$IE6){if(pageSize[1]>pageSize[3]){Core.Dom.setStyle(this_shadow,"width",pageSize[0]+"px")}else{Core.Dom.setStyle(this_shadow,"width",pageSize[0]-22+"px")}}else{Core.Dom.setStyle(this_shadow,"width",pageSize[0]+"px")}}if(scope.$IE){Core.Dom.setStyle(this_shadow,"height",pageSize[3]+60+"px")}else{Core.Dom.setStyle(this_shadow,"height",pageSize[1]+"px")}if(scope.$IE6){this_shadow.style.position="absolute";this_shadow.style.left="0px";var scrollTop=Core.System.getScrollPos()[0];this_shadow.style.top=scrollTop-30+"px";Core.Events.addEvent(window,function(){var scrollTop=Core.System.getScrollPos()[0];this_shadow.style.top=scrollTop-30+"px"},"scroll")}else{this_shadow.style.position="fixed"}},setFixed:function(){this.fix=window.setInterval(Core.Function.bind2(this.setMiddle,this),500)},clearFixed:function(){window.clearInterval(this.fix)}};Sina.Utils.dialog.prototype.onresize=function(){var self=this;var pageSize=Core.System.pageSize();var pageW=pageSize[0];var pageH=pageSize[1];Core.Dom.setStyle2(self.__shadow,{width:pageW+"px",height:pageH+"px"});self.setMiddle()};
Module.Login.LoginUI=Core.Class.create();Module.Login.LoginUI.prototype={initialize:function(){},show:function(callback,isFlash){checkAuthor();if($isLogin){callback();return}if(!Core.Events.getEvent()){isFlash=true}this.callbackFunc=callback;var rdm=new Date().valueOf();var url=new Utils.Url("http://icp.cws.api.sina.com.cn/login/pflogin.html");if(this.callbackFunc){url.setParam("callback","true")}var content=url.toString();var obj={ad:true,drag:true,title:"通行证登录",shadow:1};var func={onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onContentUpdate:function(){},onPosUpdate:function(){},onShow:function(){window.isLoginShow=true},onHidden:function(){if(window.isLoginShow){window.isLoginShow=null}}};dialog=new Sina.Utils.dialog(obj,func);dialog.setHelp("http://blog.sina.com.cn/lm/help/2009/index.html");dialog.setIframe({"url":content,"width":390,"height":"170"});if(isFlash){dialog.setMiddle()}else{dialog.setMiddle()}dialog.show();scope.loginDialog=dialog},hide:function(){},callback:function(){this.hide();this.callbackFunc.call();this.callbackFunc=null}};$registJob("init_loginUI",function(){trace("初始化登录");scope.login_interface=new Module.Login.LoginUI();$login=scope.login_interface.show.bind2(scope.login_interface)});
Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};
Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(this.loadFrames!=null){return false}var rndId1="loadingIframe_thread"+Math.ceil(Math.random()*10000);var rndId2="loadingIframe_thread"+Math.ceil((Math.random()+1)*10000);this.loadFrames=[rndId1,rndId2];var html='<iframe id="'+rndId1+'" name="'+rndId1+'" class="invisible"scrolling="no" src=""allowTransparency="true" style="display:none;" frameborder="0"><\/iframe><iframe id="'+rndId2+'" name="'+rndId2+'" class="invisible"scrolling="no" src=""allowTransparency="true" style="display:none;" frameborder="0"><\/iframe>';var oIjaxIframeCnt=$C("div");oIjaxIframeCnt.id="ijax_iframes";oIjaxIframeCnt.innerHTML=html;trace("创建 Ijax 需要的 iframe");document.body.appendChild(oIjaxIframeCnt);var loadTimer=setInterval(Core.Function.bind2(function(){if($E(this.loadFrames[0])!=null&&$E(this.loadFrames[1])!=null){clearInterval(loadTimer);loadTimer=null;this.loadingIframe={"thread1":{"container":$E(this.loadFrames[0]),"isBusy":false},"thread2":{"container":$E(this.loadFrames[1]),"isBusy":false}};this.loadByList()}},this),10)},isIjaxReady:function(){if(typeof this.loadingIframe=="undefined"){return false}for(var oLoadCnt in this.loadingIframe){if(this.loadingIframe[oLoadCnt].isBusy==false){this.loadingIframe[oLoadCnt].isBusy=true;return this.loadingIframe[oLoadCnt]}}return false},request:function(url,option){var oTask={};oTask.url=url;oTask.option=option||{};this.arrTaskLists.push(oTask);if(this.loadFrames==null){this.createLoadingIframe()}else{this.loadByList()}},loadByList:function(){if(this.arrTaskLists.length==0){return false}var loadStatus=this.isIjaxReady();if(loadStatus==false){return false}var newData=this.arrTaskLists[0];this.loadData(newData.url,newData.option,loadStatus);this.arrTaskLists.shift()},loadData:function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}_url.setParam("domain","1");_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,'textarea','')[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=Core.String.encodeDoubleByte(option.POST[oItem]);oIjaxForm.appendChild(oInput)};document.body.appendChild(oIjaxForm);oIjaxForm.submit()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}};
Sina.pkg("Module.Component");
Core.Function.cache=function(func){return function(){var o=func.__cache__=func.__cache__?func.__cache__:{};var key=Core.Array.foreach(arguments,function(v){return v}).toString();return o[key]?o[key]:o[key]=func.apply(func,arguments)}};
Sina.pkg("Utils.Flash");
if(typeof deconcept=="undefined"){var deconcept=new Object()}if(typeof deconcept.util=="undefined"){deconcept.util=new Object()}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object()}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9)}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true)},setAttribute:function(_e,_f){this.attributes[_e]=_f},getAttribute:function(_10){return this.attributes[_10]},addParam:function(_11,_12){this.params[_11]=_12},getParams:function(){return this.params},addVariable:function(_13,_14){this.variables[_13]=_14},getVariable:function(_15){return this.variables[_15]},getVariables:function(){return this.variables},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key]}return _16},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" "}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\""}_19+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />"}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />"}_19+="</object>"}return _19},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}return false}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(_23.major==6){return _23}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}}return _23};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false}if(this.major>fv.major){return true}if(this.minor<fv.minor){return false}if(this.minor>fv.minor){return true}if(this.rev<fv.rev){return false}return true};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1))}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;Utils.Flash.swfObject=deconcept.SWFObject;
Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};
Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};
Core.String.expand=function(str){var r=str.replace(/([\u00ff-\ufffe])/gi,"\uffff$1");return r};
Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};
var windowDialog={msgbox:function(op){op=op||{};op.type=op.type||"confirm";var isWidth=typeof op.w!='undefined'?"_w":"";this.tpl=new Utils.Template(this["struc_"+op.type+isWidth]);var data={};data.icon=this.icons[op.icon];data.msg1=op.content||"";data.msg2=op.content2||"";var obj={};obj.title=op.title||"提示";obj.content=this.tpl.evaluate(data);obj.middle=op.middle||true;this.dialog=new Sina.Utils.dialog(obj,{});this.dialog.show();if(op.type=='alert'){var btn_con=Core.Dom.getElementsByClass(this.dialog.__body,"p","CP_w_btns")[0]}else{var btn_con=Core.Dom.getElementsByClass(this.dialog.__body,"p","CP_w_btns")[0]}Core.Array.foreach(op.btns||[],function(v,i){var b=$C("a");b.className="CP_a_btn2";b.href="javascript:void(0)";b.id="btn_"+parseInt(Math.random()*10000);b.innerHTML="<cite>"+v.text+"</cite>";Core.Events.addEvent(b,v.func||function(){});Core.Events.addEvent(b,this.dialog.hidden.bind2(this.dialog));btn_con.appendChild(b);if(v.focus){b.focus()}btn_con.appendChild(document.createTextNode(" "))}.bind2(this));return this.dialog},icons:{"01":"CP_ib_suce","02":"CP_ib_fail","03":"CP_ib_warn","04":"CP_ib_query","05":"","06":"CP_ib_priv"},struc_confirm:'<div class="CP_layercon1"><div class="CP_prompt"><img class="CP_ib #{icon}" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /><table class="CP_w_ttl"><tr><td>#{msg1}</td></tr></table><div class="CP_w_cnt">#{msg2}</div><p class="CP_w_btns">#{btns}</p></div></div>',struc_confirm_w:'<div class="CP_layercon2"><div class="CP_prompt"><img class="CP_ib #{icon}" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /><table class="CP_w_ttl"><tr><td>#{msg1}</td></tr></table><div class="CP_w_cnt">#{msg2}</div><p class="CP_w_btns">#{btns}</p></div></div>',struc_alert:'<div class="CP_layercon1"><div class="CP_prompt"><img align="absmiddle" title="" alt="" src="http://simg.sinajs.cn/common/images/CP_ib.gif" class="CP_ib #{icon}"/><table class="CP_w_ttl"><tbody><tr><td>#{msg1}</td></tr></tbody></table><div class="CP_w_cnt">#{msg2}</div><p class="CP_w_btns">#{btns}</p></div></div>',alert:function(content,op){var obj={};op=op||{};obj.title=op.title||"提示";obj.content=content||"";obj.content2=op.content2||"";obj.icon=op.icon||"01";obj.type=op.type||"alert";var btns=[];var temobj={text:op.textOk||"确定",func:op.funcOk||function(){}};btns.push(temobj);if(typeof op.textCancel!='undefined'){var temobj={text:op.textCancel||"取消",func:function(){}};btns.push(temobj)}if(btns.length>1){btns[1].focus=true}else{btns[0].focus=true}obj.btns=btns;return this.msgbox(obj)},confirm:function(content,op){var obj={};op=op||{};obj.title=op.title||"提示";obj.content=content||"";obj.content2=op.content2||"";obj.icon=op.icon||'04';obj.type="confirm";obj.w=op.w;obj.btns=[{text:op.textOk||"是",func:op.funcOk||function(){},focus:op.defaultButton==1?true:false},{text:op.textCancel||"否",func:op.funcCancel||function(){},focus:true}];return this.msgbox(obj)}};App.showDialogContent={init:function(content,settings){var c=content||'';settings=settings||{};var dialogCfg={ad:true,title:settings.title||"提示！",drag:false,zindex:3000,shadow:settings.shadow,css:"Dialog",content:content||"",middle:settings.middle,resizable:settings.resizable};var func={};var btnContainer=settings.btnContainer;var dialog=new Sina.Utils.dialog(dialogCfg,func);this.dialog=dialog;this.dialog.setContent(c);this.dialog.show();if(typeof settings.middle=='undefined'){this.dialog.setMiddle()}if(typeof settings.top!='undefined'&&typeof settings.left!='undefined')this.dialog.setPosition(settings.left,settings.top);var btns=[];if($E(btnContainer&&typeof settings.textOk!='undefined')){var but1={text:settings.textOk,func:settings.funcOk||function(){},focus:settings.defaultButton==1?true:false,isOpened:settings.isOpened};btns.push(but1);if(typeof settings.textCancel!='undefined'){var but2={text:settings.textCancel,func:settings.funcCancel||function(){},focus:true};btns.push(but2)}Core.Array.foreach(btns||[],function(v,i){var b=$C("a");b.className="CP_a_btn2";b.href="javascript:void(0);";b.id="btn_"+parseInt(Math.random()*10000);b.innerHTML="<cite>"+v.text+"</cite>";Core.Events.addEvent(b,v.func||function(){});if(typeof v.isOpened=='undefined'||v.isOpened)Core.Events.addEvent(b,dialog.hidden.bind2(dialog));$E(btnContainer).appendChild(b);if(v.focus){b.focus()}})}else{this.dialog.__close.focus()}return this.dialog},dialog:null};
Sina.pkg("Module.ComponentRender");
Module.ComponentRender.renderByList=function(list){Core.Array.foreach(list,function(v,i){try{if($E("module_"+v)!=null){var comp=new Module.Component["Comp_"+v]();comp.load();trace("组件 ："+v+" 初始化成功","#00FF00","#666666");if(typeof scope.currentModule=="undefined"){scope.currentModule={}}scope.currentModule[v]=comp}else{throw new Error("组件 ："+v+" 初始化失败，页面内缺少组件的HTML节点")}}catch(e){trace(e.message||"组件 ："+v+" 初始化失败，请确认该组件类是否定义过","#FFCC6B","#666666")}finally{}})};
Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};
Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest()}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){trace("create request failed")}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+'='+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){_url.setParam("rnd",Math.random())}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if(Core.Base.detect.$IE){response=request.responseXML}else{var Dparser=new DOMParser();response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");trace(sParameter);request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}}};
Sina.pkg("Core.Math");
Core.Math.getRandomNumber=function(_start,_end){if(isNaN(_start)||isNaN(_end)||_start<0&&_end<0){return null}var _s=Math.ceil(Math.min(_start,_end));var _e=Math.floor(Math.max(_start,_end));_s=_s>0?_s:0;return Math.round(_s+Math.random()*(_e-_s))};
App.processTip=Core.Class.create();App.processTip.prototype={initialize:function(){var div=$C("div");this.id=Core.Math.getRandomNumber(10,999);div.className="CP_waiting";div.innerHTML=this.getStruc();div.id="processTip"+this.id;div.style.position="absolute";div.style.top="0px";div.style.right="0px";document.body.appendChild(div);this.tip=div;this.tip.style.display="none"},defaultProgress:"正在保存中...",setTipText:function(text){$E("tip_text_"+this.id).innerHTML=text},show:function(){this.tip.style.display=""},hide:function(){this.tip.style.display="none"},lock:function(){this.timer=setInterval(function(){var p=Core.System.getScrollPos();this.tip.style.top=p[0]+"px";this.tip.style.right=2-p[1]+"px"}.bind2(this),50)},unlock:function(){clearInterval(this.timer)},onInit:function(){},onProgress:function(){this.lock();this.show()},onComplete:function(){window.setTimeout(function(){this.hide();this.unlock()}.bind2(this),500)},onError:function(){},getStruc:function(){return'<img align="absmiddle" title="" alt="" src="http://simg.sinajs.cn/common/images/CP_i.gif" class="CP_i CP_i_wait"/><strong>正在保存中...</strong>'}};
var Interface=function(url,type,displayTip){this.url=new Utils.Url(url);this.type=type.toLowerCase();this.displayTip=displayTip||false};Interface.prototype={url:null,type:"",request:function(option){var err=option.onError;var suc=option.onSuccess;this.tip=this.displayTip?new App.processTip():null;var tip=this.tip;option.onComplete=option.onSuccess=function(result){try{if(typeof result=="string"){result=result.replace(/;$/,"")}result=(typeof result=="string"&&(/\s*{/.test(result)))?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}if(result!=null){if(result.code=="A00006"||result.code=="S00001"){suc(result.data)}else{err(result)}}else{err(result)}if(tip){tip.onComplete()}}catch(e){traceError(e)}}.bind2(this);option.onException=option.onError=option.onFail||function(){trace("接口失败："+this.url,"#F00");if(arguments.length>0){for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&typeof arguments[i]!="undefined"){trace("错误信息："+arguments[i].toString())}}}}.bind2(this);var requestURL=this.url.toString();if(this.tip){this.tip.onProgress()}switch(this.type){case"ijax":Utils.Io.Ijax.request(requestURL,option);break;case"ajax":Utils.Io.Ajax.request(requestURL,option);break;case"script":case"jsload":Utils.Io.JsLoad.request(requestURL,option);break;default:throw new Error("未指定有效的数据传输类型")}}};
Module.Component.updateComponentToConf=function(_data,_callback){var _param={uid:scope.$uid,productid:scope.pid_map[scope.$PRODUCT_NAME],module:_data};var _comps_manage=new Interface("http://icp.cws.api.sina.com.cn/pfconf/module_manager.php",$IE6?"ijax":"jsload");var _post=_callback||{};_post.GET=_param;if(_callback==null){_post.onSuccess=function(_data){trace("success:"+_data);window.location.reload()};_post.onError=function(_data){trace("error:"+_data.code);showError(_data.code)};_post.onFail=function(){traceError("S00001")}}_comps_manage.request(_post)};
manageComp=Module.Component.manage=function(sId){if(typeof scope.currentModule[sId]!="undefined"&&typeof scope.currentModule[sId].manage!="undefined"){scope.currentModule[sId].manage()}else if(sId>1000&&sId<=2000){sUrl="http://control.blog.sina.com.cn/admin/custom/custmod/edit_custmod.php?cid="+sId+"&"+Math.random();Module.SetComps._open("manage",sUrl)}else if(sId>2000){trace("App组件 "+sId+" 管理")}else{trace("1000以下的组件，但未定义管理功能")}};refreshComp=Module.Component.reload=function(sId){var arrRefreshComp=[];for(var i=0;i<arguments.length;i++){arrRefreshComp[i]=arguments[i]}setTimeout(Module.ComponentRender.renderByList(arrRefreshComp),2000)};hideComp=Module.Component.manage=function(sId,states){windowDialog.confirm(arguments.length==2?"确实要隐藏此模块吗？此模块的活动已结束，隐藏后不可恢复。":"要隐藏该内容模块吗？隐藏后可以在页面设置模块中再次显示。",{textOk:"是",funcOk:function(){var compConfig=config.component;var compList=[];for(var i=1,len=parseInt(compConfig.x)+1;i<len;i++){config.component["c"+i]=compConfig["c"+i]=Core.Array.ArrayWithout(compConfig["c"+i],[sId]);compList.push(compConfig["c"+i])}var _delComp=new Interface("http://icp.cws.api.sina.com.cn/pfconf/module_hidden.php",$IE6?"ijax":"jsload");_delComp.request({GET:{uid:scope.$uid,productid:scope.pid_map[scope.$PRODUCT_NAME],moduleid:sId},onSuccess:function(){window.removeComp(sId);if(typeof config.component.c3!="undefined"&&config.component.c3.length==0){if(Core.Dom.getElementsByClass($E("column_2"),"div","column3empty")==0){var emptySig=$C("div");emptySig.className="column3empty";emptySig.innerHTML="您可将模块放置在此!";$E("column_2").appendChild(emptySig)}}},onError:function(_data){showError(_data.code)},onFail:function(){trace("组件删除接口请求异常");showError("A00001")}})},textCancel:"否"})};window.removeComp=function(sId){if($E("module_"+sId)){Core.Dom.removeNode($E("module_"+sId))}};
Module.Component.Comp=Core.Class.create();Module.Component.Comp.prototype={initialize:function(){if(this.isInit==true){return}this.isInit=true},compId:0,template:"",addFlash:function(option){if(option==null||typeof option.url=="undefined"){return}var _url=option.url,_id=option.id||("compflash_"+this.compid),_height=option.height||300,_ver="8",_bg="#FFF";var _vars=option.vars||{},_para=option.para||{};var _cnt="comp_"+this.compid+"_content";Core.Dom.addHTML(this.getContent(),'<div id="'+_cnt+'" class="CP_li"></div>');Utils.Flash.swfView.Add(_url,_cnt,_id,190,_height,_ver,_bg,_vars,_para)},clear:function(){},display:function(value){this.getContainer().style.display=value},getTitle:function(){return Core.Dom.getElementsByClass($E("module_"+this.compid),"span","title floatLeft")[0]},getManage:function(){},getContainer:function(){return $E("module_"+this.compid)},getContent:function(){return Core.Dom.getElementsByClass($E("module_"+this.compid),"div","componentContent")[0]},load:function(){trace(">>> load");this.parse()},parse:function(){trace(">>> parse");this.show()},reload:function(){this.clear();this.load()},setTitle:function(){},showError:function(){trace("组件加载失败");this.getContent().innerHTML='<div class="nodata2">组件加载失败。</div>'},showEmpty:function(){trace("组件无数据");this.getContent().innerHTML='<div class="nodata2">暂无内容。</div>'},show:function(sResult){trace(">>> show");this.getContent().innerHTML=sResult||"";this.finalize()},finalize:function(){}};
Core.Class.extend=function(destination,source){for(var property in source){destination[property]=source[property]}return destination};
Core.Class.define=function(init,superClz,methods){if(init&&init.__isClass&&init.__isClass()){throw new Error("class cnt be used as another class' constructor : "+init)}superClz=superClz||Object;methods=methods||{};methods.initialize=init||methods.initialize||superClz.prototype.initialize||(function(){});if(typeof(methods.initialize)!="function"){throw new Error("only function can be used as constructor")}methods.__isClass=function(){return true};var clz=Core.Class.create();clz.__isClass=methods.__isClass;var proto=superClz==Object?{}:new superClz(Core.Class.AsPrototype);clz.prototype=Core.Class.extend(proto,methods);return clz};
$registComp=Module.Component.registComp=function(id,override,superClass){superClass=Module.Component["Comp_"+superClass];superClass=superClass||Module.Component.Comp;override.compid=id;Module.Component["Comp_"+id]=Core.Class.define(null,superClass,override)};
$registComp("app",{url:"http://space.sina.com.cn////",load:function(){Utils.Io.Ijax.request(this.url,{GET:{cid:this.compId}.bind2(this),onComplete:function(resultText){this.show(resultText)}.bind2(this),onException:function(){this.show("数据读取失败！")}.bind2(this)})}});
Module.ComponentRender.renderApp=function(compList){Core.Array.foreach(compList,function(v,i){$registComp(v,{},"app")});Module.ComponentRender.renderByList(compList)};
Module.ComponentRender.renderWidget=function(compList){var url="http://v.space.sina.com.cn/module/getmdinfo.php?modules="+compList.join(",");Utils.Io.JsLoad.request(url,{onComplete:function(){},onError:function(){},onException:function(){Module.ComponentRender.renderByList(compList)}})};
var CommendArticleByTags=Core.Class.create();CommendArticleByTags.prototype={initialize:function(tag,tags,option){this.tag=tag;this.tags=tags;this.option=option},fix:function(){var regString=this.tags;var regArr=regString.split("|");var flag=false;var j=0;while(flag!==true&&j<regArr.length){var pattern=new RegExp(regArr[j]);if(this.tag.search(pattern)>-1){flag=true}j++}return flag},buildData:function(data){var txthead=this.option.html;if(data.search("暂无相关博文")>-1&&this.option.url){data=html+'</ul></div><!--#recopholis#//--><div class=\"CP_j_linedot CP_j_linedot2\"></div><div class=\"recomore\"><a target=\"_blank\" href=\"'+this.option.url+'\">查看更多>></a></div></div>'}else{data=txthead+data.substring(30)}return data}};CommendArticles=Core.Class.create();CommendArticles.prototype={initialize:function(){this.articles=[]},add:function(articleObj){this.articles.push(articleObj)},execute:function(data,type){len=this.articles.length;for(var i=0;i<len;i++){if(this.articles[i].fix()){data=this.articles[i].buildData(data);if(!type){break}}}return data}};
$registJob("comp_render903",function(){var defaultList=[903];Module.ComponentRender.renderByList(defaultList)});$registComp(903,{load:function(){this.loadArticle()},loadArticle:function(){var _tagcode=(typeof $tag_code!="undefined")?$tag_code:"";var article_inter=new Interface("","ijax");Utils.Io.Ijax.request("http://tag.blog.sina.com.cn/tag/tag_walist_v5.php",{GET:{blog_id:scope.$articleid,tag:encodeURI($tag),tag_code:_tagcode},onComplete:function(data){var commend2=new CommendArticleByTags($tag,"游戏|网游|网络游戏|在线游戏",{url:"http://uni.sina.com.cn/c.php?ie=utf-8&e=utf8&k=%E6%B8%B8%E6%88%8F&ts=&key=&keyword=&t=blog",data:data,html:"<div class=\"recoatlis2\"><ul><li><p><a title=\"背靠大树《纷争》成功拉拢新浪\" target=\"_blank\" href=\"http://blog.sina.com.cn/s/blog_5e183e960100cuhz.html\">背靠大树《纷争》成功拉拢新浪</a></p><p class=\"recoatlis_aut CP_linkb\"><a  title=\"纷争官方博客\" target=\"_blank\"  href=\"http://blog.sina.com.cn/fzol\">纷争官方博客 </a></p></li>"});var commend3=new CommendArticleByTags($tag,"精明|节俭|节约|省钱|经济危机|节油|节省|划算|便宜",{"data":data,"html":"<div class=\"recoatlis2\"><ul><li><p><a title=\"经济危机下如何才能“不差钱”\" target=\"_blank\" href=\"http://sina.allyes.com/main/adfclick?db=sina&bid=155668,197008,202002&cid=0,0,0&sid=189940&advid=5719&camid=27182&show=ignore&url=http://blog.sina.com.cn/s/blog_4e7274a90100cun1.html\">经济危机下如何才能“不差钱”</a></p><p class=\"recoatlis_aut CP_linkb\"><a  title=\"红色小高跟鞋\" target=\"_blank\"  href=\"http://blog.sina.com.cn/hsggx\">红色小高跟鞋</a></p></li>"});var cArticles=new CommendArticles();cArticles.add(commend2);cArticles.add(commend3);this.loadPicture(cArticles.execute(data))}.bind2(this),onException:function(){trace("connect error")}})},loadPicture:function(sResult){var _pic_url="http://blog.sina.com.cn/lm/iframe/article/sort_"+this.articleCate[scope.$sort_id]+"_"+Math.ceil(Math.random()*3)+"_v1.html";Utils.Io.Ijax.request(_pic_url,{onComplete:function(data){trace("相关博文返回内容="+data);this.getContent().innerHTML=sResult.replace(/<!--#recopholis#\/\/-->/,data)}.bind2(this),onException:function(){trace("connect error")}})},articleCate:{"105":"105","102":"117","104":"104","149":"149","113":"113","153":"117","111":"117","152":"122","122":"122","131":"131","127":"108","134":"149","145":"108","108":"108","130":"130","116":"116","129":"129","136":"129","125":"125","141":"108","118":"118","117":"117"}});
$registComp(904,{load:function(){var _url="http://blog.sina.com.cn/main/top_new/article_sort/"+scope.$sort_id+"_day.v1.html";Utils.Io.Ijax.request(_url,{onComplete:function(data){this.show(data)}.bind2(this),onException:function(){trace("connect error");this.showError()}.bind2(this)})}});
$SYSMSG.extend({"A10007":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10008":"已达黑名单数1000上限，不能继续加黑名单。","A10010":"已加过对方为黑名单。","A10011":"操作失败，系统繁忙或遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10012":"加黑名单失败，请重试。","A10013":"操作失败，系统繁忙或遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10014":"操作失败，系统繁忙或遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10015":"被加入黑名单的用户，不能给你留言、发纸条，不能加你为好友、不能加你为关注，不会在你的访客中留下访问记录。  "});
function addToBlackPersion(uid,callback){if(arguments.length==2){var func={};func.onSuccess=callback.onSuccess||function(){};var _inter=new Interface("http://icp.cws.api.sina.com.cn/friend/AddBlack.php?black_uid="+uid,$IE6?"ijax":"jsload");_inter.request({onSuccess:function(){func.onSuccess()},onError:function(e){showError(e.code)}})}else if(arguments.length==1){window.windowDialog.confirm("确实要将此人加入黑名单吗？",{funcOk:function(){var _inter=new Interface("http://icp.cws.api.sina.com.cn/friend/AddBlack.php?black_uid="+uid,$IE6?"ijax":"jsload");_inter.request({onSuccess:function(e){window.windowDialog.alert("成功将\""+sUnick+"\"加入黑名单。",{icon:"01"})},onError:function(e){showError(e.code)}})},content2:"被加入黑名单的用户，不能给你发纸条、不能加你为好友、不能加你为关注，不会在你的访客中留下访问记录。",textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"})}}
$SYSMSG.extend({"A10005":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10006":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。"});
$SYSMSG.extend({"A10007":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A10008":"已达黑名单数1000上限，不能继续加黑名单。","A10010":"已加过对方为黑名单。","A70202":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A70102":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A70104":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。","A70105":"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电95105670。"});
var platDeleteView=function(uid,type,product,subid){this._uid=uid;this._type=type;if(arguments.length==3){this._product=product}if(arguments.length==4){this._product=product;this._subid=subid}this._ran=parseInt(Math.random()*10000);this._did="del_"+this._ran;this._oid="ok_"+this._ran};platDeleteView.prototype={initialize:function(){var _this=this;var obj={ad:false,drag:true,title:"提示",content:_this.getHTML(),shadow:1,close:true,middle:true};var func={};var dialog=new Sina.Utils.dialog(obj,func);this.bindEvent();return dialog},getHTML:function(){var html='';if(this._type=="c"||this._type=="p"){if($isAdmin){html+='<div class="CP_layercon2"><div class="layerRow"><div class="title"><img class="CP_ib CP_ib_query" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /></div><div class="cont w330"><p class="sTit"><strong>确实要删除此访问记录吗？</strong></p><p class="c666"><input class="iptChk" type="checkbox" id="isAddBlack"/>加入黑名单</p><p class="c999 l20" >'+$SYSMSG["A10015"]+'</p></div><p class="space5"></p><p class="tCenter"><a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._oid+'\">&nbsp;&nbsp;是&nbsp;&nbsp;</cite></a>&nbsp;<a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._did+'\">&nbsp;&nbsp;否&nbsp;&nbsp;</cite></a></p></div></div></div>'}else{html+='<div class="CP_layercon2"><div class="layerRow"><div class="title"><img class="CP_ib CP_ib_query" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /></div><div class="cont w330"><p class="sTit"><strong>确实要删除此访问记录吗？</strong></p></div><p class="space5"></p><p class="tCenter"><a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._oid+'\">&nbsp;&nbsp;是&nbsp;&nbsp;</cite></a>&nbsp;<a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._did+'\">&nbsp;&nbsp;否&nbsp;&nbsp;</cite></a></p></div></div></div>'}}else if(this._type=="f"){html+='<div class="CP_layercon2"><div class="layerRow"><div class="title"><img class="CP_ib CP_ib_query" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /></div><div class="cont w330"><p class="sTit"><strong>确实要删除此好友吗？</strong></p><p class="c666"><input class="iptChk" type="checkbox" id="isAddBlack"/>加入黑名单</p><p class="c999 l20" >'+$SYSMSG["A10015"]+'</p></div><p class="space5"></p><p class="tCenter"><a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._oid+'\">&nbsp;&nbsp;是&nbsp;&nbsp;</cite></a>&nbsp;<a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._did+'\">&nbsp;&nbsp;否&nbsp;&nbsp;</cite></a></p></div></div></div>'}else if(this._type=="b"){html+='<div class="CP_layercon2"><div class="layerRow"><div class="title"><img class="CP_ib CP_ib_query" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" /></div><div class="cont w330"><p class="sTit"><strong>确实要解除此黑名单吗？</strong></p></div><p class="space5"></p><p class="tCenter"><a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._oid+'\">&nbsp;&nbsp;是&nbsp;&nbsp;</cite></a>&nbsp;<a href="javascript:;" class="CP_a_btn2" onclick="return false;"><cite id=\"'+this._did+'\">&nbsp;&nbsp;否&nbsp;&nbsp;</cite></a></p></div></div></div>'}return html},bindEvent:function(){var _self=this;Core.Events.addEvent($E(this._oid),this.save.bind2(_self),"click");Core.Events.addEvent($E(this._did),this.hidden.bind2(_self),"click")},show:function(){this.dialog=this.dialog||this.initialize();this.dialog.show()},save:function(){this.hidden();var url="";var option={};var productMap={"blog":1,"vblog":2,"photo":8,"music":1024,"tiezi":64};var self=this;if(this._type=="c"||this._type=="p"){trace("productMap[self._product]="+self._product);if(typeof this._subid!=='undefined'){url="http://footprint.cws.api.sina.com.cn/del.php?pid="+productMap[self._product]+"&subid="+this._subid+"&uid="+scope.$uid+"&deleteuid="+this._uid;if($E("isAddBlack")&&$E("isAddBlack").checked){url+="&inblack=1"}}else{url="http://footprint.cws.api.sina.com.cn/del.php?pid="+productMap[self._product]+"&uid="+scope.$uid+"&deleteuid="+this._uid;if($E("isAddBlack")&&$E("isAddBlack").checked){url+="&inblack=1"}}option={onComplete:(function(txt){switch(txt.code){case"A00006":window.location.reload();break;default:showError(txt.code);break}}).bind2(this),onException:function(txt){},charset:"utf-8"}}else if(this._type=="f"){url="http://icp.cws.api.sina.com.cn/friend/DelFriend.php?friend_uid="+this._uid;if($E("isAddBlack")&&$E("isAddBlack").checked){url+="&inblack=1"}else{url+="&inblack=0"}option={onComplete:(function(txt){switch(txt.code){case"A00006":window.location.reload();break;default:showError(txt.code);break}}).bind2(this),onException:function(txt){},charset:"utf-8"}}else if(this._type=="b"){url="http://icp.cws.api.sina.com.cn/friend/DelBlack.php?black_uid="+this._uid;option={onComplete:(function(txt){switch(txt.code){case"A00006":window.location.reload();break;default:showError(txt.code);break}}).bind2(this),onException:function(txt){},charset:"utf-8"}}Utils.Io.JsLoad.request(url,option);while($E("isAddBlack")){Core.Dom.removeNode("isAddBlack")}},hidden:function(){this.dialog.hidden()}};function $deleteVistorOrFirendOrBlack(uid,type,product,subid){trace(typeof arguments.length);if(arguments.length==2)var platdelview=new platDeleteView(uid,type);else if(arguments.length==3){var platdelview=new platDeleteView(uid,type,product)}else{var platdelview=new platDeleteView(uid,type,product,subid)}platdelview.show()}
$registComp("12",{dataUrl:"http://footprint.cws.api.sina.com.cn/listhtml.php",load:function(){var _urlcfg=this.getParam();trace("load has been overwrote.");var _visitor=(this.getReqObject!=null)?this.getReqObject():new Interface(this.dataUrl,"jsload");_visitor.request({GET:_urlcfg,onSuccess:(function(result){if(result.record==""){this.showEmpty()}else{this.show(result.record)}}).bind2(this),onError:(function(result){this.parse(result.code)}).bind2(this),onFail:(function(){this.showError()}).bind2(this)})},showEmpty:function(){this.getContent().innerHTML='<div class="nodata2">暂无访客。</div>'},getParam:function(){var _urlcfg={uid:scope.$uid,pagesize:12};var _pid={"blog":1,"vblog":2,"quanzi":4,"photo":8,"space":128,"tiezi":64,"music":1024};_urlcfg.pid=_pid[scope.$PRODUCT_NAME];return _urlcfg},parse:function(arrData){trace("parse has been overwrote.");var _template=this.template||'<div><b>#{name}</b></div><div>#{url}</div>';_template=new Utils.Template(_template);var str=_template.evaluateMulti(arrData);this.show(str)},show:function(sResult){trace("show has been overwrote.");trace("html="+sResult);this.getContent().innerHTML=sResult;this.finalize()}});
$registComp(47,{getParam:function(){var _urlcfg={uid:scope.$uid,pagesize:12};_urlcfg.pid=1;_urlcfg.subid=scope.$articleid;return _urlcfg},load:function(){var arr=config.component.c3?config.component.c1.concat(config.component.c3):config.component.c1;if(Core.Array.findit(arr,"12")==-1){this.display("none");return}this.display("block");var _urlcfg=this.getParam();trace("load has been overwrote.");var _visitor=(this.getReqObject!=null)?this.getReqObject():new Interface(this.dataUrl,"jsload");_visitor.request({GET:_urlcfg,onSuccess:(function(result){if(result.record==""){this.showEmpty()}else{this.show(result.record)}}).bind2(this),onError:(function(result){this.parse(result.code)}).bind2(this),onFail:(function(){this.showError()}).bind2(this)})}},12);
Module.Component.parseList=function(_list,_default){var defaultCompList=_default||[];Module.ComponentRender.renderByList(defaultCompList);var _compList=Core.Array.ArrayWithout(_list,defaultCompList);if(_compList.length>0){var appCompList=[],widgetCompList=[];Core.Array.foreach(_compList,function(e){if(e>2000){appCompList.push(e)}else{widgetCompList.push(e)}});if(widgetCompList.length>0){Module.ComponentRender.renderWidget(widgetCompList)}if(appCompList.length>0){Module.ComponentRender.renderApp(appCompList)}}};$registJob("comp_render",function(){var _list=config.component.x;var compConfig=[];for(var m=0;m<_list;m++){compConfig=compConfig.concat(config.component["c"+m])}var compList=[];for(var i=1,len=parseInt(compConfig.x)+1;i<len;i++){compList=compList.concat(compConfig["c"+i])}var defaultList=[904,47];Module.Component.parseList(compList,defaultList)});
Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML('BeforeBegin',html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML('AfterBegin',html);return el.firstChild;case"beforeend":el.insertAdjacentHTML('BeforeEnd',html);return el.lastChild;case"afterend":el.insertAdjacentHTML('AfterEnd',html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'};
function formatnumber(n){n=n+"";return n.replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,")}
$SetPV=function(o){o=parseInt(o);$E("blogInfoCount").innerHTML='<strong class="Num_family">'+formatnumber(o)+'</strong>';var grade=0;var score=[0,50,100,150,200,300,500,800,1500,3000,5000,10000,15000,25000,40000,70000,100000,150000,200000,500000,1000000,2000000,5000000,10000000,20000000,50000000,100000000,150000000,200000000,250000000,300000000,350000000,400000000,450000000,500000000,550000000];if(o>=50000000){config.grade=Math.floor(o/50000000)+24}else{config.grade=-1;score=score.join(",").replace(/(\d+)/g,function(a,b){if(window.parseInt(b)<=o){config.grade++}})}config.grade=config.grade.toString().replace(/(\d)/g,function($0,$1){return"<img src=\"http://simg.sinajs.cn/common/images/rank_num/"+$1+".gif\"/>"});$E("blogInfoGrade").innerHTML=config.grade};
function v6SendLog(type,label,param){var o=new Image();o.src="http://blog.sina.com.cn/main_v5/ria/ii.html?type="+type+"&label="+label+"&parm="+param+"&"+new Date().valueOf()}
scope.Inter_see_add=new Interface("http://icp.cws.api.sina.com.cn/attention/attention_add.php","jsload");
$SYSMSG.extend({"A33001":"关注失败!<br/>你已经加过对方为关注了，请不要重复添加！","A33002":"关注失败!<br/>对方拒绝了你的关注请求！","A33005":"关注失败!<br/>你不能添加自己为关注！","A33008":"取消关注失败","A33009":"移除关注成功，加黑名单失败"});
var Layer=function(template){this.entity=null;this.ifm=null;var _this=this;var Property={width:0,height:0,x:0,y:0,isFixed:false,uniqueID:"",entityID:"",contentID:"",template:template,nodes:{}};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();p.uniqueID="_"+_this.getUniqueID();p.entityID=p.uniqueID+"_entity";p.contentID=p.uniqueID+"_content";_this.setTemplate(p.template);p.nodes=_this.getNodes();p.width=parseInt(_this.entity.style.width);if(Core.Base.detect.$IE6){_this.addIframe()}document.body.appendChild(_this.entity);_this.hidden()})();this._ie6Fixed=function(){_this.entity.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px";if(_this.ifm){_this.ifm.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.ifm.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px"}}};Layer.prototype={setTemplate:function(template){var p=this.getProperty();p.template=template;if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}this.entity=$C("div");var tempEntity=$C("div");var tmp=new Utils.Template(p.template);tempEntity.innerHTML=tmp.evaluate(this.getNodes("i"));document.body.appendChild(tempEntity);if(!$E(p.entityID)||!$E(p.contentID)){throw new Error("[Error from layer.js] there missing #{entityID} or #{contentID} in layer template")}else{this.entity=$E(p.entityID);this.entity.style.position="absolute";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";document.body.replaceChild(this.entity,tempEntity);tempEntity=null}},setSize:function(opts){var p=this.getProperty();Core.Base.parseParam(p,opts);if(opts.width){p.nodes.content.style.width=p.width+"px"}if(opts.height){p.nodes.content.style.height=p.height+"px"}this.updateIfmSize()},setPosition:function(opts){var p=this.getProperty();Core.Base.parseParam(p,opts);this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";if(Core.Base.detect.$IE6&&p.isFixed){this.entity.style.left=p.x+document.documentElement.scrollLeft+"px";this.entity.style.top=p.y+document.documentElement.scrollTop+"px"}if(this.ifm){this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top}},updateIfmSize:function(){if(this.ifm){var _this=this;_this.ifm.style.width=_this.entity.offsetWidth+"px";_this.ifm.style.height=_this.entity.offsetHeight+"px"}},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;var _this=this;if(Core.Base.detect.$IE6){_this.entity.style.position="absolute";if(p.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}if(p.isFixed&&Core.Base.detect.$FF2){_this.updateFixed();return}this.entity.style.position=p.isFixed?"fixed":"absolute"},updateFixed:function(){var p=this.getProperty();if(p.isFixed&&Core.Base.detect.$FF2){var _this=this;var lastX=p.x,lastY=p.y;_this.entity.style.position="absolute";_this.setPosition({x:p.x+document.documentElement.scrollLeft,y:p.y+document.documentElement.scrollTop});_this.entity.style.position="fixed";_this.setPosition({x:lastX,y:lastY})}},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display="";this.updateIfmSize()}},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;document.body.appendChild(this.ifm);Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(mode){var p=this.getProperty();var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=p.template.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(p.uniqueID+"_"+r);break;case"i":nodes[r]=p.uniqueID+"_"+r;break}}}return nodes},getUniqueID:function(){return parseInt(Math.random()*10000).toString()+(new Date).getTime().toString()},setContent:function(sHTML){var p=this.getProperty();if(sHTML){p.nodes.content.innerHTML=sHTML}}};
var Drag3=function(beDragObj,movedObjs,dragMode){var _this=this;this.beDragObj=beDragObj;this.movedObjs=movedObjs||this.beDragObj;this.dragMode=dragMode||"normal";this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.dragSet={"normal":function(){_this.normalDrag()},"border":function(){_this.borderDrag()},"opacity":function(){_this.opacityDrag()}};this.dragObjsFunc=function(){_this.onDrag();_this.dragObjs()};(function initialize(){_this.beDragObj.style.MozUserSelect="none";Core.Events.addEvent(_this.beDragObj,function(){return false},"selectstart");Core.Events.addEvent(_this.beDragObj,function(){return false},"drag");for(var i=0;i<_this.movedObjs.length;i++){if(_this.movedObjs[i]!=_this.beDragObj){_this.movedObjs[i].style.position="absolute";if(!_this.movedObjs[i].style.left){_this.movedObjs[i].style.left=_this.movedObjs[i].offsetLeft+"px"}if(!_this.movedObjs[i].style.top){_this.movedObjs[i].style.top=_this.movedObjs[i].offsetTop+"px"}}}Core.Events.addEvent(_this.beDragObj,_this.dragSet[_this.dragMode],"mousedown");if(Core.Base.detect.$IE){Core.Events.addEvent(_this.beDragObj,function(){Core.Events.removeEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove");_this.beDragObj.releaseCapture();_this.onDragEnd()},"mouseup")}else{Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,_this.dragObjsFunc,"mousemove");_this.onDragEnd()},"mouseup")}})()};Drag3.prototype={capture:function(){this.canDrag=true},release:function(){this.canDrag=false},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var i=0;i<this.movedObjs.length;i++){if(this.isLock){if(e.clientX-this.movedObjs[i].deltaX<this.lockArea.left){this.movedObjs[i].style.left=this.lockArea.left+"px"}else{if(e.clientX-this.movedObjs[i].deltaX>this.lockArea.right-this.movedObjs[i].offsetWidth){this.movedObjs[i].style.left=this.lockArea.right-this.movedObjs[i].offsetWidth+"px"}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px"}}if(e.clientY-this.movedObjs[i].deltaY<this.lockArea.top){this.movedObjs[i].style.top=this.lockArea.top+"px"}else{if(e.clientY-this.movedObjs[i].deltaY>this.lockArea.bottom-this.movedObjs[i].offsetHeight){this.movedObjs[i].style.top=this.lockArea.bottom-this.movedObjs[i].offsetHeight+"px"}else{this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px";this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}},normalDrag:function(){var _this=this;e=Core.Events.getEvent();for(var i=0;i<_this.movedObjs.length;i++){_this.movedObjs[i].deltaX=e.clientX-parseInt(_this.movedObjs[i].style.left);_this.movedObjs[i].deltaY=e.clientY-parseInt(_this.movedObjs[i].style.top)}if(_this.canDrag){if(Core.Base.detect.$IE){_this.beDragObj.setCapture();Core.Events.addEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove")}else{Core.Events.addEvent(document,_this.dragObjsFunc,"mousemove")}}_this.onDragStart()},borderDrag:function(obj,borderWidth){},opacityDrag:function(obj,opacityValue){}};Utils.Drag3=Drag3;
var Dialog=function(template){var _this=this;_this.entity=null;_this.ifm=null;var Property={id:"",x:0,y:0,width:0,height:0,isFixed:false,layer:new Layer(template),template:template,canDrag:false,dragEntity:null,name:"",uniqueID:"",isShow:false,nodes:{},focusNode:null};this.getProperty=function(){return Property};(function initialize(){var p=_this.getProperty();var i;p.uniqueID=p.layer.getProperty().uniqueID;p.id=p.uniqueID+"_dialog";p.nodes=_this.getNodes();_this.entity=p.layer.entity;_this.ifm=p.layer.ifm;p.width=parseInt(_this.entity.style.width);if(p.nodes.titleBar){p.dragEntity=new Utils.Drag3(p.nodes.titleBar,_this.ifm?[_this.ifm,_this.entity]:[_this.entity]);p.nodes.titleBar.style.cursor="move";Core.Events.addEvent(_this.entity,function(){return false},"selectstart");p.dragEntity.onDrag=function(){_this.onDrag()}}})()};Dialog.prototype={setPosition:function(opts){var p=this.getProperty();Core.Base.parseParam(p,opts);this.getProperty().layer.setPosition(opts)},setSize:function(opts){var p=this.getProperty();Core.Base.parseParam(p,opts);p.layer.setSize(opts)},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;this.getProperty().layer.setFixed(p.isFixed)},setTemplate:function(template){var p=this.getProperty();p.template=template;p.layer.setTemplate(p.template)},setDrag:function(canDrag){var p=this.getProperty();p.canDrag=canDrag;if(p.canDrag){p.dragEntity.capture()}else{p.dragEntity.release()}},show:function(){this.getProperty().isShow=true;this.getProperty().layer.show();this.onShow()},close:function(){this.getProperty().isShow=false;this.getProperty().layer.hidden();this.destroy();this.onClose()},hidden:function(){this.getProperty().isShow=false;this.getProperty().layer.hidden();this.onHidden()},destroy:function(){try{if(this.getProperty().nodes.iframe){this.getProperty().nodes.iframe.src=""}}catch(ex){}this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},setAreaLocked:function(state){var p=this.getProperty();p.dragEntity.isLock=state;var _this=this;if(state){_this._updateLockArea();Core.Events.addEvent(window,function(){_this._updateLockArea()},"resize")}},_updateLockArea:function(){var p=this.getProperty();var win=Core.System.winSize();if(p.isFixed){if(Core.Base.detect.$IE6){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height};Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"scroll")}else{p.dragEntity.lockArea={left:0,right:win.width,top:0,bottom:win.height}}}else{p.dragEntity.lockArea={left:0,right:Math.max(document.documentElement.scrollWidth,win.width),top:0,bottom:Math.max(document.documentElement.scrollHeight,win.height)}}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(mode){return this.getProperty().layer.getNodes(mode)},setFocus:function(){var p=this.getProperty();if(p.focusNode&&p.focusNode.style.display!="none"){try{p.focusNode.focus()}catch(ex){}}else if(this.entity.style.display!="none"){this.entity.focus()}},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}};
var DialogManager={dialogs:[],activeDialog:{},backShadow:null,create:function(tpl,name){var _this=this;var dialog=new Dialog(tpl);this.dialogs.push(dialog);this.activeDialog=dialog;dialog.name=name||dialog.getUniqueID();dialog.entity.style.zIndex=1024;dialog.onDrag=function(){if(Core.Base.detect.$IE6){if(this.getProperty().isFixed){this.setPosition({x:(parseInt(this.entity.style.left)-document.documentElement.scrollLeft),y:(parseInt(this.entity.style.top)-document.documentElement.scrollTop)})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}};dialog.onClose=function(){_this.removeDialog(this.name);_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onHidden=function(){this.isHidden=true;if(this==_this.activeDialog){_this.activeDialog=null}_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onShow=function(){if(this.isHidden){this.isHidden=false;var i,len=_this.dialogs.length;for(i=0;i<len;i++){if(_this.dialogs[i]==this){document.body.appendChild(_this.dialogs[i].entity);_this.dialogs.push(_this.dialogs[i]);_this.dialogs.splice(i,1)}}_this.activeDialog=this;_this.backShadow.show();_this.updateShadow()}};if(this.backShadow.isShow){this.updateShadow()}else{this.backShadow.show()}dialog.hidden();return dialog},getDialog:function(name){var i=0,len=this.dialogs.length;for(i=0;i<len;i++){if(this.dialogs[i].name==name){return this.dialogs[i]}}},removeDialog:function(name){var i=0,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs.splice(i,1);this.activeDialog=this.dialogs[this.dialogs.length-1];break}}},updateActiveDialog:function(){var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(!this.dialogs[i].isHidden){this.activeDialog=this.dialogs[i];break}}},updateShadow:function(){if(this.activeDialog&&!this.activeDialog.isHidden){this.backShadow.insertBefore(this.activeDialog.entity);this.activeDialog.updateFixed()}else{this.backShadow.hidden()}},close:function(name){if(!name){if(this.activeDialog){this.activeDialog.close()}return}var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs[i].close();break}}}};
var BackShadow=function(opacity){this.entity=null;this.isShow=false;this._ie6Fixed=function(){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.entity.style.left=document.documentElement.scrollLeft+"px";if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;_this.ifm.style.left=_this.entity.style.left}};var _this=this;(function initialize(){_this.entity=$C("div");_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=1024;_this.entity.style.backgroundColor="black";document.body.appendChild(_this.entity);Core.Dom.setStyle(_this.entity,"opacity",isNaN(opacity)?0.5:opacity);if(Core.Base.detect.$IE6){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.addIframe()}Core.Events.addEvent(window,function(){_this.updateSize()},"resize");_this.setFixed(true);_this.hidden()})()};BackShadow.prototype={show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}this.isShow=true},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.isShow=false},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;document.body.insertBefore(this.ifm,this.entity);Core.Dom.setStyle(this.ifm,"opacity",0)},insertBefore:function(obj){document.body.insertBefore(this.entity,obj);if(this.ifm){document.body.insertBefore(this.ifm,this.entity)}},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px";this.entity.style.height=this.getAreaHeight()+"px";if(this.ifm){this.ifm.style.width=this.getAreaWidth()+"px";this.ifm.style.height=this.getAreaHeight()+"px"}},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(state){if(Core.Base.detect.$IE6){var _this=this;if(state){Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}}};
function CustomsDialog(tpl,name){this._dialog=DialogManager.create(tpl,name);this._contentTemplate="";this.nodes={};var _this=this;(function initialize(){_this._dialog.onDrag=function(){if(Core.Base.detect.$IE6){if(this.getProperty().isFixed){this.setPosition({x:(parseInt(this.entity.style.left)-document.documentElement.scrollLeft),y:(parseInt(this.entity.style.top)-document.documentElement.scrollTop)})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}_this.onDrag()};_this.updateNodes();Core.Events.addEvent(_this.nodes.btnClose,function(){Core.Events.getEvent().cancelBubble=true},"mousedown")})();this._hiddenDialog=function(){_this.hidden()};this._closeDialog=function(){_this.close()}}CustomsDialog.prototype={setContent:function(tpl){this._contentTemplate=tpl;var tmp=new Utils.Template(this._contentTemplate);this.nodes.content.innerHTML=tmp.evaluate(this.getContentNodes("i"));this.updateNodes()},setTitle:function(title){if(this.nodes.titleName){this.nodes.titleName.innerHTML=title}},setHelp:function(helpLink){if(this.nodes.btnHelp){if(helpLink){this.nodes.btnHelp.style.display="";this.nodes.btnHelp.href=helpLink}else{this.nodes.btnHelp.style.display="none"}}},setClose:function(mode){var _this=this;if(_this.nodes.btnClose){mode=mode||"hidden";switch(mode){case"hidden":Core.Events.addEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");break;case"close":Core.Events.addEvent(_this.nodes.btnClose,_this._closeDialog,"click");break}}},setPosition:function(x,y){this._dialog.setPosition({x:x,y:y})},setMiddle:function(){var win=Core.System.winSize();var scrollPos=Core.System.getScrollPos();var posTop=this._dialog.getProperty().isFixed?0:scrollPos[0];var posLeft=this._dialog.getProperty().isFixed?0:scrollPos[1];this._dialog.setPosition({x:win.width/2-this.nodes.content.offsetWidth/2+posLeft,y:win.height/2-this.nodes.content.offsetHeight/2+posTop})},setSize:function(width,height){this._dialog.setSize({width:width,height:height})},setFixed:function(state){this._dialog.setFixed(state)},setAreaLocked:function(state){this._dialog.setAreaLocked(state)},setFocusNode:function(focusNode){this._dialog.getProperty().focusNode=focusNode},getWidth:function(){return this._dialog.getProperty().width},getHeight:function(){return this._dialog.getProperty().height},getX:function(){return this._dialog.getProperty().x},getY:function(){return this._dialog.getProperty().y},show:function(){this._dialog.show();this.onShow()},hidden:function(){this._dialog.hidden();this.onHidden()},close:function(){var _this=this;_this._dialog.close();_this.onClose();Core.Events.removeEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");Core.Events.removeEvent(_this.nodes.btnClose,_this._CloseDialog,"click")},updateNodes:function(){this.nodes=this._dialog.getNodes();var contentNodes=this.getContentNodes();for(k in contentNodes){this.nodes[k]=contentNodes[k]}},getContentNodes:function(mode){var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=this._contentTemplate.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(this.nodes.content.id+"_"+r);break;case"i":nodes[r]=this.nodes.content.id+"_"+r;break}}}return nodes},onDrag:function(){},onShow:function(){},onHidden:function(){},onClose:function(){}};
var LayerTemplate={"alert":'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</thead>'+'<tfoot>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tfoot>'+'<tbody>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<!-- 内容区域 -->'+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+'<p/>'+'</div>'+'</div>'+'<div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a></div>'+'</div>'+'<!-- 内容区域 -->'+'</div>'+'</td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tbody>'+'</table>',"confirm":'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</thead>'+'<tfoot>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tfoot>'+'<tbody>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<!-- 内容开始 -->'+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+'<p/>'+'</div>'+'</div>'+'<div class="btnRow">'+'<a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a>'+'<a class="gBtnb gBtnbClr" id="#{linkCancel}" href="javascript:;"><cite id="#{btnCancel}"><em id="#{cancel}"></em></cite></a>'+'</div>'+'</div>'+'<!-- 内容结束 -->'+'</div>'+'</td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tbody>'+'</table>',"iframe":'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</thead>'+'<tfoot>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tfoot>'+'<tbody>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<div id="#{loadState}">Loading...</div>'+'<iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe>'+'</div>'+'</td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tbody>'+'</table>',"customs":'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</thead>'+'<tfoot>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tfoot>'+'<tbody>'+'<tr>'+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<!-- 内容区域 -->'+'<!-- 内容区域 -->'+'</div>'+'</td>'+'<td class="tbgright"><div></div></td>'+'</tr>'+'</tbody>'+'</table>'};
(function(){var WindowDialog=function(backShadow,objTemplate){this.template=objTemplate||{};DialogManager.backShadow=backShadow};WindowDialog.prototype={iconSet:{"01":{"class":"gIcoC05","alt":"警告"},"02":{"class":"gIcoC06","alt":"失败"},"03":{"class":"gIcoC07","alt":"成功"},"04":{"class":"gIcoC08","alt":"询问"}},alert:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.alert||LayerTemplate.alert,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.show();dialog.setFixed(true);dialog.setAreaLocked(true);if(nodes.linkOk){nodes.linkOk.focus();dialog.getProperty().focusNode=nodes.linkOk}if(nodes.text){nodes.text.innerHTML=text}if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["01"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["01"]["alt"]}if(nodes.ok){nodes.ok.innerHTML=cfg["textOk"]||"确定"}if(nodes.subText){cfg["subText"]=cfg["subText"]||"";if(cfg["subText"]!=""){nodes.subText.innerHTML=cfg["subText"]}}dialog.setSize({width:cfg["width"]||nodes.content.offsetWidth,height:cfg["height"]||nodes.content.offsetHeight});dialog.setPosition({x:win.width/2-dialog.getProperty().width/2,y:win.height/2-dialog.getProperty().height/2});Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]){cfg["funcOk"]()}dialog.close()},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},confirm:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.confirm||LayerTemplate.confirm,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.show();dialog.setFixed(true);dialog.setAreaLocked(true);if(cfg["defaultButton"]==0){if(nodes.linkCancel){nodes.linkCancel.focus();dialog.getProperty().focusNode=nodes.linkCancel}}else{if(nodes.linkOk){nodes.linkOk.focus();dialog.getProperty().focusNode=nodes.linkOk}}if(nodes.text){nodes.text.innerHTML=text}if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["01"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["01"]["alt"]}if(nodes.ok){nodes.ok.innerHTML=cfg["textOk"]||"确定"}if(nodes.cancel){nodes.cancel.innerHTML=cfg["textCancel"]||"取消"}if(nodes.subText){cfg["subText"]=cfg["subText"]||"";if(cfg["subText"]!=""){nodes.subText.innerHTML=cfg["subText"]}}dialog.setSize({width:cfg["width"]||nodes.content.offsetWidth,height:cfg["height"]||nodes.content.offsetHeight});dialog.setPosition({x:win.width/2-dialog.getProperty().width/2,y:win.height/2-dialog.getProperty().height/2});Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]){cfg["funcOk"]()}dialog.close()},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnCancel,function(){if(cfg["funcCancel"]){cfg["funcCancel"]()}dialog.close()},"click");Core.Events.addEvent(nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcCancel"]){cfg["funcCancel"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},showIframe:function(cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.iframe||LayerTemplate.iframe,name);var win=Core.System.winSize();var scroll_pos=Core.System.getScrollPos();var nodes=dialog.getNodes();dialog.show();dialog.setFixed(cfg.fixed);dialog.setAreaLocked(true);if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||""}nodes.iframe.src=cfg["url"]||"about:blank";dialog.setSize({width:cfg["width"]||nodes.content.offsetWidth,height:cfg["height"]||nodes.content.offsetHeight});dialog.setPosition({x:win.width/2-dialog.getProperty().width/2,y:win.height/2-dialog.getProperty().height/2+(cfg.fixed?0:scroll_pos[0])});Core.Events.addEvent(nodes.iframe,function(){if(nodes.loadState){nodes.loadState.style.display="none"}},"load");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},createCustomsDialog:function(cfg,name){cfg=cfg||{};var customsDialog=new CustomsDialog(cfg.tpl||this.template.customs||LayerTemplate.customs,name);customsDialog.setContent(cfg.content||"");customsDialog.setTitle(cfg.title||"提示");customsDialog.setHelp(cfg.help||"");customsDialog.setSize(cfg.width||320,cfg.height||150);customsDialog.setClose("hidden");return customsDialog},getDialog:function(name){return DialogManager.getDialog(name)},close:function(name){DialogManager.close(name)}};Sina.Utils.WindowDialog=WindowDialog})();
var DialogTemplate={"alert":'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+'<tr>'+'<th><strong id="#{titleName}"></strong><cite id="#{btnClose}"><a href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite></th>'+'</tr>'+'</thead>'+'<tbody>'+'<tr>'+'<td>'+'<div id="#{content}" class="CP_layercon1">'+'<div class="CP_prompt">'+'<img id="#{icon}" class="" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" />'+'<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>'+'<div class="CP_w_cnt" id="#{subText}"></div>'+'<p class="CP_w_btns"><a id="#{linkOk}" href="javascript:;" class="CP_a_btn2"><cite id="#{btnOk}">&nbsp;<span id="#{ok}"></span>&nbsp;</cite></a></p>'+'</div>'+'</div>'+'</td>'+'</tr>'+'</tbody>'+'</table>',"confirm":'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+'<tr>'+'<th><strong id="#{titleName}"></strong><cite id="#{btnClose}"><a href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite></th>'+'</tr>'+'</thead>'+'<tbody>'+'<tr>'+'<td>'+'<div id="#{content}" class="CP_layercon1">'+'<div class="CP_prompt">'+'<img id="#{icon}" class="" src="http://simg.sinajs.cn/common/images/CP_ib.gif" align="absmiddle" alt="" title="" />'+'<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>'+'<div class="CP_w_cnt" id="#{subText}"></div>'+'<p class="CP_w_btns">'+'<a id="#{linkOk}" href="javascript:;" class="CP_a_btn2"><cite id="#{btnOk}">&nbsp;<span id="#{ok}"></span>&nbsp;</cite></a>'+'<a id="#{linkCancel}" href="javascript:;" class="CP_a_btn2"><cite id="#{btnCancel}">&nbsp;<span id="#{cancel}"></span>&nbsp;</cite></a>'+'</p>'+'</div>'+'</div>'+'</td>'+'</tr>'+'</tbody>'+'</table>',"iframe":'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+'<tr>'+'<th>'+'<strong id="#{titleName}"></strong>'+'<cite>'+'<a target="_blank" id="#{btnHelp}" class="CP_w_help" href="javascript:;" style="display: none;">帮助</a>'+'<a title="关闭" id="#{btnClose}" class="CP_w_shut" href="javascript:;" style="display: block;">关闭</a>'+'</cite>'+'</th>'+'</tr>'+'</thead>'+'<tbody>'+'<tr>'+'<td id="#{content}" style="vertical-align: top;">'+'<div id="#{loadState}">Loading...</div>'+'<iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe>'+'</td>'+'</tr>'+'</tbody>'+'</table>',"customs":'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+'<tr>'+'<th>'+'<strong id="#{titleName}"></strong>'+'<cite>'+'<a target="_blank" id="#{btnHelp}" class="CP_w_help" href="javascript:;" style="display: none;">帮助</a>'+'<a title="关闭" id="#{btnClose}" class="CP_w_shut" href="javascript:;" style="display: block;">关闭</a>'+'</cite>'+'</th>'+'</tr>'+'</thead>'+'<tbody>'+'<tr>'+'<td id="#{content}" style="vertical-align: top;">'+'</td>'+'</tr>'+'</tbody>'+'</table>'};var iconSet={"01":{"class":"CP_ib CP_ib_warn","alt":"警告"},"02":{"class":"CP_ib CP_ib_fail","alt":"失败"},"03":{"class":"CP_ib CP_ib_suce","alt":"成功"},"04":{"class":"CP_ib CP_ib_query","alt":"询问"}};var dialogBackShadow;var winDialog={},_winDialog;winDialog.alert=function(text,cfg,name){if(!_winDialog){initDialog();_winDialog.alert(text,cfg,name)}else{_winDialog.alert(text,cfg,name)}};winDialog.confirm=function(text,cfg,name){if(!_winDialog){initDialog();_winDialog.confirm(text,cfg,name)}else{_winDialog.confirm(text,cfg,name)}};winDialog.showIframe=function(cfg,name){if(!_winDialog){initDialog();_winDialog.showIframe(cfg,name)}else{_winDialog.showIframe(cfg,name)}};winDialog.createCustomsDialog=function(cfg,name){if(!_winDialog){initDialog();return _winDialog.createCustomsDialog(cfg,name)}else{return _winDialog.createCustomsDialog(cfg,name)}};function initDialog(){dialogBackShadow=new BackShadow(0.4);_winDialog=new Sina.Utils.WindowDialog(dialogBackShadow,{"alert":DialogTemplate.alert,"confirm":DialogTemplate.confirm,"iframe":DialogTemplate.iframe,"customs":DialogTemplate.customs});_winDialog.iconSet=iconSet}
Module.SeeState=Core.Class.extend(Module.SeeState||{},{add:function(aid){if(!$isLogin){$login(function(){checkAuthor();this.save(aid)}.bind2(this))}else{this.save(aid)}},save:function(aid){var param={uid:$UID,aid:aid||$uid};scope.Inter_see_add.request({GET:param,onSuccess:function(_data){},onError:function(_data){switch(_data.code){case"A33003":var msg="关注失败!<br/><span style='font-weight:100;font-size:12px;'>已达关注上限300，不能再添加新的关注了！你可以先到<a href='http://profile.blog.sina.com.cn/attention.php?uid="+$UID+"' target='_blank'>“我关注的人”</a>去取消关注一些人，再回来关注。</span>";winDialog.alert(msg);break;case"A33004":var msg="关注成功!<br/><span style='font-weight:100;font-size:12px;'>你将在关注动态页面接收到对方的新信息。<br/><a href='http://profile.blog.sina.com.cn/attention_feed.php?uid="+$UID+"' target='_blank'> 查看关注动态</a>>><br/><a href='http://profile.blog.sina.com.cn/attention.php?uid="+$UID+"' target='_blank'> 查看我关注的人</a>>><br/><a href='http://profile.blog.sina.com.cn/attention.php?uid="+$UID+"&type=1' target='_blank'> 查看谁在关注我</a>>></span>";winDialog.alert(msg,{icon:"03",funcOk:function(){window.location.reload()}});break;default:showError(_data.code)}},onFail:function(){}})}});
scope.Inter_see_number=new Interface("http://blogtj.sinajs.cn/api/get_attention_num.php","jsload");
Module.SeeState=Core.Class.extend(Module.SeeState||{},{setHotNumber:function(){if($E("attention_hot")){var param={"uid":$uid,"attention":"suid"};scope.Inter_see_number.request({GET:param,onSuccess:function(_data){$E("attention_hot").innerHTML='<strong><a href="http://profile.blog.sina.com.cn/attention.php?uid='+$uid+'&type=1" target="_blank">'+_data[$uid]+"</a></strong>"},onError:function(_data){trace("error:"+_data)},onFail:function(){}})}}});
$registJob("comp_render909",function(){var defaultList=[909];Module.ComponentRender.renderByList(defaultList)});$registComp(909,{load:function(){if($E("article_tj_grade")){this.show($E("article_tj_grade"))}if($E("tj_id")){this.showTJList($E("tj_id"))}},showTJList:function(_container){var _isOnline=Utils.Io.JsLoad.request("http://blogtj.sinajs.cn/api/get_tj_article_info.php",{GET:{"uid":scope.$uid,"varname":"tjData","ran":Math.random()*10000},onComplete:(function(result){var tp='<LI><P><A  href="#{href}" onclick="v6SendLog(\'blog\',\'tj\',\'articles\');" target=_blank>#{content}</A></P><P><A class=CP_txtb href="#{srcHref}" onclick="v6SendLog(\'blog\',\'tj\',\'operation\');" target=_blank>#{src}</A></P></LI>';var content="";var data=result.data;var len=result.data.length>5?5:result.data.length;if(len===0){_container.innerHTML='<P class="CP_txta jian_no">暂无被推荐博文</P>';return}for(var i=0;i<len;i++){var info={};info.href="http://blog.sina.com.cn/s/blog_"+data[i].blog_id+".html?tj=1";info.content=data[i].blog_title;info.srcHref=data[i].tj_chanel_id_url;info.src=data[i].tj_chanel_id_str;var temp=new Utils.Template(tp).evaluate(info);content+=temp}_container.innerHTML='<ul id="tj_id" class="jian_ul">'+content+"</ul>"}).bind2(this),onException:(function(){this.showError()}).bind2(this)})},show:function(_container){var _grade='<DIV class="CP_pfli blog_jian"><UL class="CP_pfli CP_j_linedot1s"><LI><EM class=CP_txtc><A href="http://blog.sina.com.cn/lm/help/2009/index.html" onclick="v6SendLog(\'blog\',\'tj\',\'help\');" target=_blank>博客等级</A>：</EM><CITE><STRONG id="blogInfoGrade"></STRONG></CITE><LI><EM class=CP_txtc><A href="http://blog.sina.com.cn/lm/help/2009/index.html" onclick="v6SendLog(\'blog\',\'tj\',\'help\');" target=_blank>博客积分</A>：</EM><CITE><STRONG  id="blogInfoScore" class=Num_family></STRONG></CITE><LI><EM>博客访问：</EM><CITE><STRONG id="blogInfoCount" class=Num_family></STRONG></CITE></LI><LI class="Attr_Num"><em class="CP_txtc"><a href="http://blog.sina.com.cn/lm/help/2009/profile.html?id=58">关注人气</a>：</em><cite><span id="attention_hot"></span> <a href="http://blog.sina.com.cn/lm/help/2009/profile.html?id=58"><img src="http://simg.sinajs.cn/common/images/icon20/CP_attract_new.gif" class="AttR_iconNew"/></a></cite></LI></UL></DIV>';var _info={};if(typeof config["private"].sms!="undefined"&&config["private"].sms!=0){_info.mmsblog='<li><p class="CP_blogmobi"><img align="absmiddle" title="已开通彩信博客" alt="" src="http://simg.sinajs.cn/common/images/CP_im.gif" class="CP_im CP_im_blog_mobi"/><a href="http://blog.sina.com.cn/main_v5/ria/mmsblog/index.html" target="_blank">已开通彩信博客</a></p></li>'}if($isAdmin&&typeof config["private"].ad!="undefined"&&config["private"].ad==1){_info.adshare='<li><p class="CP_blogad"><img align="absmiddle" title="" alt="" src="http://simg.sinajs.cn/common/images/CP_im.gif" class="CP_im CP_im_blog_ad"/><a href="http://share.sass.sina.com.cn/widget_ad/widget_ad_index.php" target="_blank">管理广告共享计划</a></p></li>'}_grade=new Utils.Template(_grade).evaluate(_info);_container.innerHTML=_grade;this.setPvNum();Module.SeeState.setHotNumber()},setPvNum:function(){if(typeof HitsV!="undefined"&&/^\d+$/.test(HitsV.pv)){$SetPV(HitsV.pv)}else{var pvurl="http://hits.blog.sina.com.cn/hits?act=3&uid="+$uidhex;Utils.Io.JsLoad.request(pvurl,{onComplete:function(data){$SetPV(data.pv)},onException:function(){$SetPV(0)}})}setTimeout(function(){Utils.Io.JsLoad.request("http://blogcnfv5.sinajs.cn/blogscr?uid="+scope.$uid+"&varname=blogScore&.js",{onComplete:function(){var _a=blogScore.coefficient.a;var _b=blogScore.coefficient.b;var _c=blogScore.coefficient.c;var _d=blogScore.coefficient.d;var _x1=blogScore.x;var _y1=blogScore.y;var _z1=blogScore.z;var _w1=blogScore.w;var _score=config.totoalscore=_x1*_a+_y1*_b+_z1*_c+_w1*_d;$E("blogInfoScore").innerHTML='<strong class="Num_family">'+formatnumber(_score)+'</strong>'},noreturn:true})},1)}},909);
Core.Dom.contains=function(oParentNode,oNode){return oParentNode.contains(oNode)};if(!$IE){Core.Dom.contains=function(oParentNode,oNode){do{if(oParentNode==oNode)return true}while(oNode=oNode.parentNode);return false}}
var Tabs=Core.Class.create();Tabs.prototype={initialize:function(container,option){trace("Tabs_init");option=option||{};var className=option.className||"";this.tabsArr=[];this.htmlEle=$C("ul");this.htmlEle.className=className;container.appendChild(this.htmlEle)},add:function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);Core.Events.addEvent(tab.element,Core.Function.bind3(this.swapTags,this,[tab]))},swapTags:function(tab){if(tab.isFocus==false){for(var i=0;i<this.tabsArr.length;i++){this.tabsArr[i].setAbort()}tab.setFocus()}else{return}}};var Tab=Core.Class.create();Tab.prototype={initialize:function(title,option){trace("Tab"+title+" is init");this.option=option||{};var isFocus=option.isFocus||false;this.className=option.className||"";this.focus=[option.onfocus];this.abotrts=[option.onabort];this.element=$C("li");if(option.cls){this.element.className=option.cls}isFocus?this.setFocus():this.setAbort();this.element.innerHTML=title},setAbort:function(){if(this.isFocus==false){return}if(this.option.cls){this.element.className=this.option.cls}else{this.element.className=""}this.isFocus=false;this.onabort()},setFocus:function(){this.element.className=this.className;this.isFocus=true;this.onfocus()},onabort:function(){for(var i=0;i<this.abotrts.length;i++){this.abotrts[i]()}},onfocus:function(){for(var i=0;i<this.focus.length;i++){this.focus[i]()}},addOnAbort:function(abortFunc){this.abotrts.push(abortFunc)},addOnFocus:function(focusFunc){this.focus.push(focusFunc)}};
Module.InsertSmiles={initDom:function(_oTextNode,_oAttachElement,_AfterInsert){if(_oTextNode==null||_oAttachElement==null){trace("请提供插入表情功能必须的节点","#F00");return false}this._inputArea=_oTextNode;var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};var _text=this._inputArea;Core.Events.addEvent(_text,getPos,"keyup");Core.Events.addEvent(_text,getPos,"focus");Core.Events.addEvent(_text,getPos,"select");Core.Events.addEvent(_text,getPos,"click");Core.Events.addEvent(_oAttachElement,function(){this._inputArea=_oTextNode;if(_AfterInsert!=null&&_AfterInsert.constructor==Function){this.AfterInsert=_AfterInsert}var _event,_eventTarget,_pos;if($E("insert_smiles_cnt")==null){var _cntHTML='<table class="CP_w" onclick="Core.Events.stopEvent();" style="width:613px;top:0px;left:0px;"><thead><tr><th><strong>插入表情</strong><cite><a id="insert_smiles_close" href="#" onclick="Module.InsertSmiles.hide(true);Core.Events.stopEvent();return false;" class="CP_w_shut" title="关闭">关闭</a></cite></th></tr></thead><tbody><tr><td><div ><div class="CP_smicnt"><div id="insert_image_type" class="CP_smibar"></div><div class="CP_smisel"><div id="insert_image_detail" class="CP_smisels"></div></div></div></div></td></tr></tbody></table>';var _smile=$C("div");_smile.style.position="absolute";_smile.id="insert_smiles_cnt";_smile.onclick="Core.Events.stopEvent()";_event=Core.Events.getEvent();_eventTarget=($IE)?_event.srcElement:_event.target;_pos=Core.Dom.getXY(_eventTarget.parentNode.parentNode);_right=Core.Dom.getStyle(_eventTarget.parentNode.parentNode,'width');var left=_event.clientX;if(left>document.body.offsetWidth/2){left=left-613}_smile.style.left=left+"px";_smile.style.top=(_pos[1]+_eventTarget.parentNode.parentNode.offsetHeight)+"px";_smile.innerHTML=_cntHTML;document.body.appendChild(_smile);Core.Events.addEvent(document,Module.InsertSmiles.hide)}else{var _smileDiv=$E("insert_smiles_cnt");_event=Core.Events.getEvent();_eventTarget=($IE)?_event.srcElement:_event.target;_pos=Core.Dom.getXY(_eventTarget.parentNode.parentNode);_right=Core.Dom.getStyle(_eventTarget.parentNode.parentNode,'width');var left=_event.clientX;if(left>document.body.offsetWidth/2){left=left-613}_smileDiv.style.left=left+"px";_smileDiv.style.top=(_pos[1]+_eventTarget.parentNode.parentNode.offsetHeight)+"px";_smileDiv.style.display="";_smileDiv.style.visibility="hidden";setTimeout(function(){Module.InsertSmiles.showDefault();_smileDiv.style.visibility="visible"},1)}if(typeof smileConfig=="undefined"){Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig.js",{onComplete:function(_data){if($E("insert_smiles_cnt")!=null){Module.InsertSmiles.init(_data)}},charset:"gb2312"})}Core.Events.stopEvent()}.bind2(this),"click")},init:function(_data){this._data=smileConfig;var _default=367;this._data[_default].isFocus=true;var vtabs=new Tabs($E("insert_image_type"));for(key in this._data){var op={className:"CP_smion",onabort:Core.Function.bind3(this.hideItems,this,[key]),onfocus:Core.Function.bind3(this.showItems,this,[key])};if(this._data[key].isFocus){op.isFocus=true}var _menu='<img align="absmiddle" alt="" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'.gif" width="20" height="20" /><a href="#" onclick="this.blur();return false;">'+this._data[key].name+'</a><cite>('+this._data[key].data.length+')</cite>';var _tab=new Tab(_menu,op);vtabs.add(_tab);if(key==_default){this.defaultTab=_tab}}this.tabs=vtabs},createType:function(key){trace("create : "+key);var _cnt=$C("ul");_cnt.className="CP_chos";_cnt.id="smiles_item_"+key;var _list=this._data[key].data;if(_list.length>0){for(var i=0,len=_list.length;i<len;i++){if(_list[i]==null){continue}var _item=$C("li");var _link=$C("a");_link.onclick="return false;";_link.title=_list[i].name;_link.innerHTML='<span><img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_list[i].code+'T.gif" /></span><em>'+_list[i].name+'</em>';Core.Events.addEvent(_link,Core.Function.bind3(this.clickImg,this,[_list[i].code,_list[i].name]));_item.appendChild(_link);_cnt.appendChild(_item)}}else{_cnt.innerHTML="该分类下暂无表情。"}$E("insert_image_detail").appendChild(_cnt)},clickImg:function(_key,_name){var _comment=this._inputArea;var len=_comment.value.length;var sSimiles="[emoticons="+_key+"]"+_name+"[/emoticons]";if($IE){if(_comment.createTextRange&&_comment.caretPos){var caretPos=_comment.caretPos;caretPos.text=caretPos.text.charAt(caretPos.text.length-1)==' '?sSimiles+' ':sSimiles;_comment.focus()}else{_comment.value+=sSimiles;_comment.focus()}}else{if(_comment.setSelectionRange){var rangeStart=_comment.selectionStart;var rangeEnd=_comment.selectionEnd;var tempStr1=_comment.value.substring(0,rangeStart);var tempStr2=_comment.value.substring(rangeEnd);_comment.value=tempStr1+sSimiles+tempStr2}else{_comment.value+=sSimiles;trace("This version of Mozilla based browser does not support setSelectionRange")}}$E("insert_smiles_cnt").style.display="none";if(this.AfterInsert){this.AfterInsert()}scope.comment_cursor_pos=null},showDefault:function(){this.tabs.swapTags(this.defaultTab);return},showItems:function(key){if($E("smiles_item_"+key)!=null){$E("smiles_item_"+key).style.display=""}else{this.createType(key);if(this.currentTab){this.hideItems(this.currentTab)}}this.currentTab=key},hideItems:function(key){if(this.currentTab&&$E("smiles_item_"+key)!=null){trace("hide : "+key);$E("smiles_item_"+key).style.display="none"}},hide:function(cls){var _event=Core.Events.getEvent(),_eventTarget=($IE)?_event.srcElement:_event.target;if($E("insert_smiles_cnt")!=null&&(Core.Dom.contains($E("insert_smiles_cnt"),_eventTarget)==false||cls==true)){$E("insert_smiles_cnt").style.display="none"}}};
$registJob("comment_insertSmile",function(){trace("初始化评论插入表情");var _cms=(scope.$isCommentAllow=="1");if(_cms){Module.InsertSmiles.initDom($E("commentArea"),$E("article_comment_insertSmile"))}});
Sina.pkg("Utils.Xml");
Utils.Xml.createXmlDoc=function(){if((typeof DOMParser)!="undefined"){return document.implementation.createDocument('','',null)}else if(window.ActiveXObject){var ActiveX=["MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"];var _xml=null;for(var i in ActiveX){try{_xml=new ActiveXObject(ActiveX[i]);break}catch(ex){}}if(_xml){return _xml}else{trace("No MSXML DOMDocument ActiveXObject")}}else{trace("browser do not support XML format")}};Utils.Xml.parse=function(str){try{var _xml;if((typeof DOMParser)!="undefined"){_xml=new DOMParser();return _xml.parseFromString(str,"text/xml")}else if(window.ActiveXObject){_xml=Utils.Xml.createXmlDoc();_xml.async=false;_xml.loadXML(str);return _xml}}catch(e){scope.trace("error occurs when parsing xml"+e)}};Utils.Xml.serialize=function(xmldoc){if(XMLSerializer){return(new XMLSerializer()).serializeToString(xml)}else if(xmldoc.xml){return xml.xml}};
$ScriptLoader={requestTable:{},request:function(url,option){option=option||{};option.charset=option.charset||"utf-8";var id="scriptId_"+Math.random();if(option.isCached)id='scriptId_cached';url=new Utils.Url(url);url.setParam("requestId",id);url=url.toString();this.requestTable[id]={id:id,url:url,option:option};var sTag=document.createElement("script");sTag.id=id;sTag.src=url;sTag.charset=option.charset;document.body.appendChild(sTag)},response:function(id,txt){if(typeof txt=="string"){}var entity=this.requestTable[id];if(entity){trace("txt="+txt);var doc=(typeof txt=="string")?Utils.Xml.parse(txt):"";trace("doc ="+doc);try{entity.option.onComplete(txt,doc)}catch(err){var oe=entity.option.onException;try{if(oe){oe(txt,doc,err)}else{scope.trace("error occurs while calling onComplete to url : "+this.requestTable[id].url+" Error : "+err)}}catch(err){}}finally{}}}};
$JsonLoader={request:function(url,option){var obj=document.createElement("script");obj.src=url;var vars=url.match(/(vars|varname|var|jv)\=(\w+)/)[2];var id="scriptId_"+Math.random();obj.id=id;obj.charset=option.charset||"UTF-8";obj[document.all?"onreadystatechange":"onload"]=function(){var vars=null;if(/[\?&](vars|varname|var|jv)\=(\w+)/.test(url)){vars=url.match(/(vars|varname|var|jv)\=(\w+)/)[2]}if(scope.$MOZ||this.readyState.toLowerCase()=='complete'||this.readyState.toLowerCase()=='loaded'){if(vars!=null){try{option.onComplete(eval(vars),"json")}catch(e){option.onComplete()}}else{option.onComplete()}}};document.body.appendChild(obj);obj=null}};
var locationJump=function(loc){window.location.href=loc};setAllArticleNumber=function(){if(scope.$pageid!="articlepreview"){var aids=scope.$articleid.replace(/^\w{10}/,"");var url="http://blogcnf.sinajs.cn/num?uid="+$uidhex+"&aids="+aids;var res="1_url_"+fav[scope.$articleid];var url2="http://collect.sinajs.cn/collect?key="+res+"&var=rs";Module.setNick.get(function(){try{document.title=document.title.replace(/([^_]*)(_\S*_)([^_]*)/,function(a,b,c,d){return b+'_'+scope.nick[scope.$uid]+'_'+d})}catch(e){}});$ScriptLoader.request(url,{onComplete:function(o){if($E("c_"+scope.$articleid)!==null){$E("c_"+scope.$articleid).innerHTML='('+o[aids].c+')';scope.$totalCommentsNum=o[aids].c}if($E("r_"+scope.$articleid)!==null){$E("r_"+scope.$articleid).innerHTML='('+o[aids].r+')'}}});$JsonLoader.request(url2,{onComplete:function(o){if($E("fn_"+scope.$articleid)!==null){if(typeof o[res]=="undefined"){$E("fn_"+scope.$articleid).innerHTML='(0)'}else{$E("fn_"+scope.$articleid).innerHTML='('+o[res]+')'}}}});Utils.Io.JsLoad.request("http://hits.blog.sina.com.cn/hits?act=4&aid="+scope.$articleid,{noreturn:true})}};$registJob("setNum",function(){setAllArticleNumber()});function changeFontSize(e){var fontClass,str="字体大小：";var template='<b>#</b>',i=3,choice=["小","中","大"];str+=new Array(4).join(template);switch(e){case 2:fontClass="big";break;case 0:fontClass="small";break;case 1:default:fontClass="normal";break}str=str.replace(/(<b>)(#)(<\/b>)/g,function(a,b,c,d){i--;if(i!=e){return'<a href="javascript:;" onclick="changeFontSize('+i+')">'+choice[i]+'</a>'}else{return b+choice[e]+d}});$E("articleFontManage").innerHTML=str;$E("articleBody").className="articleContent "+fontClass}
$ScriptLoader={requestTable:{},request:function(url,option){option=option||{};option.charset=option.charset||"utf-8";var id="scriptId_"+Math.random();if(option.isCached)id='scriptId_cached';url=new Utils.Url(url);url.setParam("requestId",id);url=url.toString();this.requestTable[id]={id:id,url:url,option:option};var sTag=document.createElement("script");sTag.id=id;sTag.src=url;sTag.charset=option.charset;document.body.appendChild(sTag);if(option.timeout!=null){$Timer[id]=setTimeout(function(){Timer(id,"s")},option.timeout)}try{option.onStart&&option.onStart()}catch(e){}},response:function(id,txt){if(typeof txt=="string"){}var entity=this.requestTable[id];if(entity){trace("txt="+txt);var doc=(typeof txt=="string")?Utils.Xml.parse(txt):"";trace("doc ="+doc);try{entity.option.onComplete(txt,doc)}catch(err){var oe=entity.option.onException;try{if(oe){oe(txt,doc,err)}else{scope.trace("error occurs while calling onComplete to url : "+this.requestTable[id].url+" Error : "+err)}}catch(err){}}finally{}}}};
$SYSMSG.extend({"B03001":"博文已收藏成功！","B03002":"已达收藏数1000条上限，不能继续收藏。","B03004":"已收藏过此博文，不能重复收藏。","B03005":"确实要取消此收藏吗？","B03006":"确实要删除此博文吗？删除后可在“回收站”恢复。","B03007":"确实要删除此草稿吗？删除后不可恢复。","B03008":"确实要彻底删除此博文吗？删除后不可恢复。","B03010":"确实要替换已置顶的博文吗？","B03011":"确实要取消置顶吗？取消后可在“博文”页恢复。","B03012":"复制成功！您可以直接粘贴(ctrl+V)到msn、qq、uc、email等通信工具中发给您的好友。","B03013":"您可以将上面的地址拷贝后发送给好友。","B03014":"博文已成功置顶到首页！","B03015":"抱歉，您的博客尚未升级，请<a href='http://blog.sina.com.cn/u/#UID' target='_blank'>升级</a>后再“收藏” 。","S01107":"已收藏过此博文，不能重复收藏。"});
$SYSMSG.extend({"B00007":"跳转到自动开通页","B00008":"自动开通用户(跳转到假页)","B00009":"跳转到自动开通页","B00010":"错误页(未开通页)","B00011":"抱歉，Blog ID 错误，操作无法完成。","B00012":"抱歉，可能因为重复操作而无法执行，请刷新本页再试。","B00013":"用户ID被封杀","B00014":"很抱歉，您输入的验证码不正确。","B04101":"请输入您的昵称！","B04102":"请正确输入您的邮件地址！","B04103":"请选择您举报信息的位置！","B04104":"请选择您举报的不良信息的类型！","B04105":"简单描述最多只能输入500个字符！","B04106":"再次感谢您帮助我们进行不良信息的验证工作，我们将认真仔细地处理您提交的内容。"});
trace("123123");function $articleManage(mUrl,action){var interUrl=["","article_del_recycle.php?blog_id[]=","article_draft_del.php?blog_id[]=","article_recycle_del.php?blog_id[]=","article_recycle_resume.php?blog_id=","favourites_save.php?blog_id=","favourites_del.php?resourceids=","article_top.php?blog_id=","article_top.php?blog_id=","article_top_del.php?blog_id="];var wenan=["","B03006","B03007","B03008","","","B03005","","B03010","B03011"];mUrl=interUrl[action]+mUrl;var url="http://control.blog.sina.com.cn/admin/article/"+mUrl+"&uid="+$UID;trace("url="+url);var msg=(wenan[action]!="")?$SYSMSG[wenan[action]]:"";checkAuthor();if(action==5){if(!$isLogin){$login(articleMana);return}else{articleMana();return}}if(!$isAdmin){return}else{if(msg==""){articleMana()}else{windowDialog.confirm(msg,{funcOk:articleMana,textOk:"是",textCancel:"否",defaultButton:1,title:"提示！",icon:"04",width:300,height:300})}}function showResult(txt){if(typeof txt=="string")txt=Core.String.j2o(txt);checkAuthor();trace("txt.code="+txt.code);switch(txt.code){case"B00001":case"B00002":case"B00004":case"B00005":case"B00010":case"B00011":case"B00012":case"B00013":case"B03002":case"B03004":showError(txt.code,"03");break;case"B00007":case"B00008":case"B00009":window.location.href="http://blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID;break;case"S01107":showError(txt.code,"03");break;case"B00003":if(this.action==5){window.windowDialog.confirm($SYSMSG["B03015"].replace("#UID",$UID),{funcOk:function(){window.open('http://blog.sina.com.cn/u/'+$UID,"_blank","")},textOk:"升级",textCancel:"关闭",icon:"03"})}else{showError(txt.code,"03")}break;case"B00004":showError(txt.code,"03");break;case"A00006":if(this.action==5){trace("收藏成功了");var dlg=window.windowDialog.alert($SYSMSG["B03001"],{funcOk:function(){$callJob("setNum")},icon:"01"});var closebtn=dlg.getCloseBtn();Core.Events.addEvent(closebtn,function(){$callJob("setNum")},'click')}else if(scope.$pageid=="articleM"){window.location.href="http://blog.sina.com.cn/s/articlelist_"+$uid+"_0_1.html"}else{trace("成功啦！刷新一下下");if(this.action==7){window.windowDialog.alert($SYSMSG["B03014"],{funcOk:function(){window.location.reload()},textOk:"确定",icon:"01"})}else{trace("aaaaction="+this.action);var currentPage;if(scope.$pageid=="articlelistM"){currentPage=Math.ceil((scope.$articlelistNum-1)/50)}if(scope.$pageid=="favouritesM"){currentPage=Math.ceil((scope.$favourNum-1)/50)}if((((this.action==1||this.action==2||this.action==3||this.action==4)&&scope.$pageid=="articlelistM")||(this.action==6&&scope.$pageid=="favouritesM"))&&scope.$page!=1&&currentPage<scope.$page){if(/status=/.test(window.location.href)){trace("bbbb");newurl=window.location.href.replace(/(status=\d+)(&p=.+)?$/,"$1&p="+currentPage)}else{trace("cccc");newurl=window.location.href.replace(/\d+(\.html)/,currentPage+"$1")}window.location.href=newurl;return}else{trace("reload()");setTimeout(function(){window.location.reload()},10)}}}break;default:showError(txt.code,"03");break}return};function requestUrl(url,action){this.action=action;this.url=url;var me=this;trace("requestUrl action="+this.action+";url="+this.url);if($IE6){Utils.Io.Ijax.request(url,{onComplete:showResult.bind2(me)})}else{Utils.Io.JsLoad.request(url,{onComplete:showResult.bind2(me),chareset:"UTF-8"})}};function articleMana(){if(action==5){if($UID==""){checkAuthor()}}requestUrl(url,action)}}
PagingLine={"_instances":{},"_language":"","_resource":{"en":["Pages (@data@): ","Go to First Page","Go to Previous Page (@data@)","Go to Page @data@","Go to Next Page (@data@)","Go to Last Page","Current Page in View"],"zh-cn":["共 @data@ 页","跳转至第一页","跳转至第 @data@ 页","跳转至第 @data@ 页","跳转至第 @data@ 页","跳转至最后一页","当前所在页"]},"Create":function PagingLine_Create(curPage,maxPage,lnkTpl,totalNum,headName){function PagingLineRender(curPage,maxPage,lnkTpl,totalNum,headName){this._curPage=curPage;this._maxPage=maxPage;this._flag=false;this._lnkTpl=lnkTpl;this._totalNum=totalNum;this._headName=headName;this._style="default";this._avStyles=["default"];this._distance=true;this._endpoint=true;this._viewSize=4;this._viewLsPage=0;this._viewRsPage=0;this._rndID=parseInt(Math.random()*100);if(arguments[3]!=null&&arguments[4]!=null){this._flag=true}this.SetStyle=function PagingLineRender_SetStyle(style){for(var i=0;i<this._avStyles.length;i++){if(style==this._avStyles[i]){this._style=style;return this}}return this};this.MarkDistance=function PagingLineRender_MarkDistance(yn){this._distance=yn;return this};this.ToggleEndpoint=function PagingLineRender_Toggle(yn){this._endpoint=yn;return this};this.SetViewSize=function PagingLineRender_SetViewSize(size){size=parseInt(size);if(4>size){size=4}else if(size%2){size--}this._viewSize=Math.floor(size/2);return this};this.SetRangeSize=function PagingLineRender_SetRangeSize(size){return this.SetViewSize(size)};this.Render=function PagingLineRender_Render(lang,oParentNode){if(!arguments.length||!arguments[0].length){lang=PagingLine.GetBrowserLanguage()}else{lang=lang.toLowerCase().replace(/_/g,"-")}this._viewLsPage=Math.max(1,this._curPage-this._viewSize);this._viewRsPage=Math.min(this._maxPage,this._curPage+this._viewSize);if(this._maxPage>11&&this._curPage<=6){this._viewLsPage=1;this._viewRsPage=10}if(this._maxPage>11&&this._curPage>(this._maxPage-6)){this._viewLsPage=this._maxPage-9;this._viewRsPage=this._maxPage}if(this._maxPage<=11){this._viewLsPage=1;this._viewRsPage=this._maxPage}var sHTML="<ul"+this._getStyle("ul")+" id='Paging_"+this._rndID+"'>";if(this._flag){sHTML+=this._getTotalNum()}sHTML+=this._getPrevBtn(lang)+this._getFirstBtn(lang)+this._getContexts(lang)+this._getLastBtn(lang)+this._getNextBtn(lang)+"</ul>";if(oParentNode){oParentNode.innerHTML=sHTML}(function(self){var links=document.getElementById("Paging_"+self._rndID).getElementsByTagName("a");var len=links.length;if((typeof self._lnkTpl).toLowerCase()=="object"){if((typeof self._lnkTpl.click).toLowerCase()=="function"){for(var i=0;i<len;i++){links[i].onclick=function(){var page=this.getAttribute("page");self._lnkTpl.click(page)}}}}})(this)};this._getTotalNum=function PagingLineRender__getTotalNum(){return"<li class=\"CP_pgttl\">共"+this._totalNum+"条"+this._headName+"</li>"};this._getSummary=function PagingLineRender__getSummary(lang){if(!this._endpoint){return""}return"<LABEL"+this._getStyle("label")+">"+this._getMeta(this._maxPage,0,lang)+"</LABEL>"};this._getFirstBtn=function PagingLineRender__getFirstBtn(lang){if(!this._endpoint){return""}if(this._curPage>6&&this._maxPage>11){return"<li><A"+this._getURL(1)+" title='"+this._getMeta("",1,lang)+"'>"+1+"</A></li>"+(this._distance?"<li"+this._getStyle("dots")+">...</li>":"")}return""};this._getLastBtn=function PagingLineRender__getFirstBtn(lang){if(!this._endpoint){return""}if(this._maxPage>11&&this._curPage<(this._maxPage-5)){return(this._distance?"<li"+this._getStyle("dots")+">...</li>":"")+"<li><A"+this._getURL(this._maxPage)+" title='"+this._getMeta("",5,lang)+"'>"+maxPage+"</A></li>"}return""};this._getPrevBtn=function PagingLineRender__getPrevBtn(lang){if(1<this._curPage){return"<li"+this._getStyle("preview")+"><A"+this._getURL(this._curPage-1)+" title='"+this._getMeta(this._curPage-1,2,lang)+"'>&lt;&nbsp;上一页"+"</A></li>"}return""};this._getNextBtn=function PagingLineRender__getNextBtn(lang){if(this._curPage<this._maxPage){return"<li"+this._getStyle("next")+"><A"+this._getURL(this._curPage+1)+" title='"+this._getMeta(this._curPage+1,4,lang)+"'>下一页&nbsp;&gt;"+"</A></li>"}return""};this._getContexts=function PagingLineRender__getContexts(lang){var sHTML="";for(var i=this._viewLsPage;i<=this._viewRsPage;i++){if(i==this._curPage){sHTML+="<li"+this._getStyle("current")+" title='"+this._getMeta("",6,lang)+"'>"+this._curPage+"</li>"}else{sHTML+="<li><A"+this._getURL(i)+" title='"+this._getMeta(i,3,lang)+"'>"+i+"</A></li>"}}return sHTML};this._getMeta=function PagingLineRender__getMeta(data,idx,lang){return PagingLine.GetResource(idx,lang).replace(/@data@/g,data)};this._getStyle=function PagingLineRender__getStyle(name){var clz;switch(name){case"preview":clz="CP_pgprev";break;case"ul":clz="CP_pages";break;case"next":clz="CP_pgnext";break;case"current":clz="CP_pgon";break;case"dots":clz="CP_pgelip";break}return" class="+clz};this._getURL=function PagingLineRender__getURL(lnkPage,quote){if(1>arguments.length){lnkPage=this._maxPage}if(2>arguments.length){quote="'"}return" href="+quote+this._lnkTpl.replace(/@page@/g,lnkPage)+quote+" target="+quote+"_self"+quote};function PagingLineRender__getURL2(lnkPage,quote){if(1>arguments.length){lnkPage=this._maxPage}if(2>arguments.length){quote="'"}return" href="+quote+"javascript: "+this._lnkTpl.click+"("+lnkPage+");"+quote}function PagingLineRender__getURL3(lnkPage,quote){if(1>arguments.length){lnkPage=this._maxPage}if(2>arguments.length){quote="'"}return" href="+quote+"#"+quote+" page="+quote+lnkPage+quote}if((typeof this._lnkTpl).toLowerCase()=="object"){if((typeof this._lnkTpl.click).toLowerCase()=="string"){this._getURL=PagingLineRender__getURL2}else{this._getURL=PagingLineRender__getURL3}}}curPage=parseInt(curPage);maxPage=parseInt(maxPage);if(1>maxPage){maxPage=1}if(1>curPage){curPage=1}else if(curPage>maxPage){curPage=maxPage}return new PagingLineRender(curPage,maxPage,lnkTpl,totalNum,headName)},"GetBrowserLanguage":function PagingLine_GetBrowserLanguage(){if(!this._language.length){this._language=(document.all?navigator.browserLanguage:navigator.language).toLowerCase()}return this._language},"GetResource":function PagingLine_GetResource(idx,lang){if(!lang.indexOf("en")){lang="en"}if(!this._resource[lang]||this._resource[lang].length<=idx){return""}return this._resource[lang][idx]}};
$SYSMSG.extend({"B36001":"操作失败，此博文不存在或被删除。","B36002":"验证码错误，请重新输入。","B36003":"请输入昵称。","B36004":"昵称必须是8个中文或16个字符以内，且不能为纯数字，请重新输入。","B36005":"呢称不能使用此类特殊词汇，请重新输入。","B36006":"昵称必须是8个中文或16个字符以内，且不能为纯数字，请重新输入。","B36007":"呢称不能使用此类特殊词汇，请重新输入。","B36008":"不能3秒内连续发评论，请梢后再试。","B36009":"不能发内容重复的评论。","B36020":"暂无评论。","B36021":"暂无评论。","B36022":"评论内容必须是1000中文或2000字符以内，请重新输入。","B36031":"操作失败，此评论不存在或被删除。","B36032":"操作失败，此评论不存在或被删除。","B36033":"操作失败，此评论不存在或被删除。","B36041":"请输入回复内容。","B36042":"回复内容必须是1000中文或2000字符以内，请重新输入。","B36043":"操作失败，自己不能回复自己的评论。","B36101":"操作失败，此博文不存在或被删除。","B36102":"评论发布失败，此博文设置不允许评论。","B36103":"操作失败，此评论不存在或被删除。","B36104":"评论已发布，需要审核后才能显示，请稍候…","B36105":"请输入评论内容。","B36106":"请输入验证码。","B36107":"请输入登录名。","B36108":"请输入密码。","B36109":"读取中，请稍候…","B36110":"读取失败，请刷新。","B36111":"确实要删除此评论吗？删除后不可恢复。","B36112":"确实要删除此回复吗？删除后不可恢复。","B36113":"博主已关闭匿名评论，请登录后再评论","B36201":"确实要删除此评论吗？删除后不可恢复。","B36202":"确实要删除此回复吗？删除后不可恢复。","B36203":"回复已经发布成功，请刷新页面查看。","B36204":"已回复该评论，请勿重复提交。","B36999":"对不起，您短时间发表的评论过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注!","36999":"对不起，您短时间发表的评论过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注!"});
Module.Status={userOnline:function(objs){var allImg=[];var onlineImg=[];var onlineUid=[];for(var i=0;i<objs.length;i++){var child=$E(objs[i]).getElementsByTagName("img");for(var j=0;j<child.length;j++){if(child[j].getAttribute("icon")=="online"&&child[j].getAttribute("uid")!="0"){onlineUid.push(child[j].getAttribute("uid"));onlineImg.push(child[j])}}}if(onlineImg.length>0){new Interface("http://v.space.sina.com.cn/person/online.php?u="+onlineUid,"jsload").request({onSuccess:function(data){for(var i=0;i<onlineImg.length;i++){if(data[onlineUid[i]]!=0){onlineImg[i].className="CP_i CP_i_on";onlineImg[i].title="当前用户在线"}}}})}},recentUpdate:function(objs){var allImg=[];var recentImg=[];var recentUid=[];for(var i=0;i<objs.length;i++){var child=$E(objs[i]).getElementsByTagName("img");for(var j=0;j<child.length;j++){if(child[j].getAttribute("icon")=="new"&&child[j].getAttribute("uid")!="0"){recentUid.push(child[j].getAttribute("uid"));recentImg.push(child[j])}}}if(!scope.$severtime){scope.$severtime=parseInt((new Date()).getTime()/1000)}if(recentUid.length>0){new Interface("http://test.sina.com.cn/person/v3/updatetimes.php?uids="+recentUid,"jsload").request({onSuccess:function(json){if(json){for(var i=0;i<recentImg.length;i++){var _uid=recentImg[i].getAttribute("uid");if(scope.$severtime-json[_uid]<=86400){recentImg[i].className="CP_i CP_i_new";recentImg[i].title="最近有更新"}}}else{return}}})}}};
App.articleCommentLoad={$ArticlePerPage:50,init:function(_page,_tip){_page=_page||scope.$comment_page;trace("加载分页："+_page);var _inter=new Interface("http://blog.sina.com.cn/s/comment_"+scope.$articleid+"_"+_page+".html","ajax");_inter.request({GET:{url_random:0},onSuccess:function(e){var _result="";var url=window.location.href;var anchor="#comment";if(e.result=="no_comment"){this.errMsg($isAdmin?"B36021":"B36020")}else{$E("article_comment_list").innerHTML='<span id="'+anchor+_page+'"></span>'+e.result}this.viewCommentPage(_page);var reg=new RegExp("("+anchor+")\\d*");if(url.indexOf(anchor)!=-1){window.location.href=url.replace(reg,"$1"+_page)}else{if(_page>1){window.location.href=anchor+_page}}}.bind2(this),onError:function(e){switch(e.code){case"B36020":case"B36021":this.errMsg($isAdmin?"B36021":"B36020");break;default:showError(e.code);this.errMsg("B36110");break}}.bind2(this),onFail:function(){this.errMsg("B36110")}.bind2(this)})},viewCommentPage:function(pageNum){var _total=(typeof scope.$totalCommentsNum!="undefined")?scope.$totalCommentsNum:0;var iMaxPage=Math.ceil(_total/this.$ArticlePerPage);iMaxPage=iMaxPage>1?iMaxPage:1;var iCurrPage=(pageNum>iMaxPage)?iMaxPage:pageNum;scope.$totalCommentsNum=_total;scope.$comment_page=iCurrPage;this.page(iCurrPage,iMaxPage)},page:function(iCurrPage,iMaxPage){trace("iCurrPage : "+iCurrPage+"/"+"iMaxPage : "+iMaxPage);if(iMaxPage>1){$E("commentPaging").style.display="";PagingLine.Create(iCurrPage,iMaxPage,{click:'App.articleCommentLoad.init'},scope.$totalCommentsNum,"评论").Render("zh-cn",$E("commentPaging"))}else{$E("commentPaging").style.display="none"}},errMsg:function(_msg){$E("article_comment_list").innerHTML='<li class="CP_litem"><div class="CP_cmt_none">'+$SYSMSG[_msg]+'</div></li>'}};$registJob("article_comment_load",function(){trace("评论显示类初始化");var _cms=(scope.$isCommentAllow=="1");if(_cms){if(typeof scope.$comment_page=="undefined"){scope.$comment_page=1}App.articleCommentLoad.init(scope.$comment_page)}else{$E("CP_cmtpost_cms").style.display="none"}$refreshComment=function(){App.articleCommentLoad.init(scope.$comment_page,true)}});
$v5include=function(jsfile,handle,_charset){var ja=new Array();var jsHash={};if(typeof jsfile=='string')ja.push(jsfile);else ja=jsfile.slice(0);var ua=navigator.userAgent.toLowerCase();var isIE=/msie/.test(ua);var isOpera=/opera/.test(ua);var isMoz=/firefox/.test(ua);for(var i=0;i<ja.length;i++){jsHash['j'+i]=false;jsHash['count_'+i]=0;var js=$C('script');js.type='text/javascript';if(_charset!=null&&_charset=="gb2312"){js.charset=_charset}js.src=ja[i];js.id='j'+i;if(isIE)js.onreadystatechange=function(){if(this.readyState.toLowerCase()=='complete'||this.readyState.toLowerCase()=='loaded'){jsHash[this.id]=true}};if(isMoz)js.onload=function(){jsHash[this.id]=true};if(isOpera)jsHash['j'+i]=true;document.body.appendChild(js)}var loadTimer=setInterval(function(){for(var i=0;i<ja.length;i++){trace(jsHash['j'+i]+";jsHash['count_'+i]="+jsHash['count_'+i]+";js.src="+ja[i]);if(jsHash['count_'+i]<5){if(jsHash['j'+i]==false){jsHash['count_'+i]++;return}}else{continue}}clearInterval(loadTimer);eval(handle)()},100)};
addAdvertise=function(){var adTop=$E("advertise_top"),adBottom=$E("advertise_bottom");if(adTop!=null){adTop.innerHTML='<div class="component"><div class="componentTop"></div><div class="componentContent" style="height:'+($IE6?81:89)+'px;padding:10px 11px;;_padding-bottom:'+($isAdmin&&$IE6?4:10)+'px;"><div class="SinaAd_cnt SinaAd_margin1">_ad_</div><span class="SinaAd_title">新浪广告<br/>共享计划</span>'+($isAdmin?'<div class="manage SinaAd_mg1"><a href="http://share.sass.sina.com.cn/widget_ad/index_out.php?done" class="SinaAd_linkcolor SinaAd_link" target="_blank">[管理]</a></div>':'')+'</div><div class="componentBottom"></div>'}if(adBottom!=null){adBottom.innerHTML='<div class="SinaAd_cnt SinaAd_margin2">_ad_</div><div style="clear:both;*margin-top:-13px;">'+($isAdmin?'<div class="manage SinaAd_mg2"><a href="http://share.sass.sina.com.cn/widget_ad/index_out.php?done" class="SinaAd_linkcolor SinaAd_link" target="_blank">[管理]</a></div>':'')+'<span class="SinaAd_title2">新浪广告共享计划</span></div>'}$v5include(["http://spacejs.sinajs.cn/view/js/adwidget.js"],function(){adShare.init(scope.$uid,'sinablog','SINABLOG')})};addAdvertise2=function(){$v5include(["http://i3.sinaimg.cn/home/sinaflash.js","http://ba.sass.sina.com.cn/front/blog/deliver?p1="+scope.$uid+",adps000001|adps000002"],function(){})};$registJob("renderAd",function(){trace("====="+typeof config.private);config.private.ad=config.private.ad||0;config.private.adver=config.private.adver||0;if(config.private.ad){trace("该用户有广告 类型1，开始载入数据。。。");addAdvertise()}if(config.private.ad||config.private.adver){trace("该用户有广告 类型2，开始载入数据。。。");addAdvertise2()}});
var ScriptionDialog=function(){};ScriptionDialog.prototype={init:function(){var _this=this;var obj={ad:false,drag:true,title:"RSS订阅",content:"",shadow:1,close:true};var func={};var dialog=new Sina.Utils.dialog(obj,func);dialog.setHelp("http://www.sina.com.cn/ddt/rsshelp.html","什么是RSS?");dialog.setIframe({url:_this.getHTML(),width:429,height:160});return dialog},getHTML:function(){var n=typeof scope.$uhost=="undefined"?scope.$uid:scope.$uhost;var url="http://control.blog.sina.com.cn/admin/login/subscription.php?n="+n+"&uid="+scope.$uid+"&"+new Date().valueOf();var html='<iframe scr="'+url+'"></iframe>';trace("url="+url);return url},show:function(){this.dialog=this.dialog||this.init();this.dialog.show()},hidden:function(){this.dialog.hidden()}};$registJob("showSubscription",function(){trace("初始化订阅对话框");var x=window.location.hash;Core.Events.addEvent("SubscribeNewRss",function(){var _Dialog=new ScriptionDialog();_Dialog.show();window.subScriptionDialog=_Dialog.dialog})});
var blogJuBao=function(url){};blogJuBao.prototype={init:function(url){var _this=this;var obj={ad:false,drag:true,title:"举报",content:"",shadow:1,close:true,width:430,height:500};var func={};var dialog=new Sina.Utils.dialog(obj,func);return dialog},Show:function(){this.dialog=this.dialog||this.init();this.dialog.setIframe({"url":scope.$jubaourl,"width":428,"height":500});this.dialog.show()},hide:function(){this.dialog.hidden()}};$jubao=function(txt){scope.$jubaourl="http://control.blog.sina.com.cn/admin/advice/impeach.php?url="+txt+"&varname=scope.$blogjubaodialog&pageid=jubao";scope.$blogjubaoDialog=new blogJuBao();scope.$blogjubaoDialog.Show()};
$registJob("setTitle",function(){if(scope.$pageid=="index"||scope.$pageid=="indexM"){Module.setNick.get(function(){document.title=scope.nick[scope.$uid]+"_新浪博客"})}else if(scope.$pageid=="article"||scope.$pageid=="articleM"){}else if(scope.$pageid=="articlelist"||scope.$pageid=="articlelistM"){}else if(scope.$pageid=="favourites"||scope.$pageid=="favouritesM"){Module.setNick.get(function(){document.title="收藏_"+scope.nick[scope.$uid]+"_新浪博客"})}else if(scope.$pageid=="friendarticle"||scope.$pageid=="friendarticleM"){Module.setNick.get(function(){document.title="好友博文_"+scope.nick[scope.$uid]+"_新浪博客"})}});
$SYSMSG.extend({"A23001":"您已经成功传递了模板，感谢您的祈福。","A23002":"您要传递爱心模板到您的博客吗？","A23003":"您已经成功替换了08欧洲杯模板。","A23004":"支持喜爱的球队，您要使用此08欧洲杯模板吗？","A23005":"你是否要使用此风格？","A23006":"已成功替换为此模版。","A23007":"抱歉！你不是博客6.0用户，不能克隆此模板。"});
App.CloneTemplate=Core.Class.create();App.CloneTemplate.prototype={id:"",confirm_text:$SYSMSG['A23005'],success_text:$SYSMSG['A23006'],action:new Function(),save_url:"http://icp.cws.api.sina.com.cn/pfconf/template_clone.php",initialize:function(cnf){this.cnf=cnf;for(var key in cnf){this[key]=cnf[key]}this.initDom();this.initEvent()},initDom:function(){var buttonHtml;if($IE&&/png$/.test(this.pic_url)){buttonHtml="<div style='cursor:hand;filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale,src=\""+this.pic_url+"\");background:none;width:"+this.cnf.width+";height:"+this.cnf.height+";'></div>"}else{buttonHtml="<img src='"+this.pic_url+"' /></a>"}Core.Dom.addHTML($E("clone_template"),'<div class="headTcBlock" id="idname_1"><div class="headTcBlock_Num" id="idname_3"></div><a class="headTcBlock_BTn" id="idname_2" href="javascript:;">'+buttonHtml+'</a></div>');if(this.desc_text){this.set_desc()}this.action()},set_desc:function(){if(this.count_id){Utils.Io.JsLoad.request("http://hits.blog.sina.com.cn/hits?act=3&uid="+this.count_id+"&varname=templateCount",{onComplete:function(){var tmp=new Utils.Template(this.desc_text);this.cnf.template_pv=templateCount.pv;$E("idname_3").innerHTML=tmp.evaluate(this.cnf)}.bind2(this)})}else{$E("idname_3").innerHTML=this.desc_text}},initEvent:function(){Core.Events.addEvent("idname_2",function(){if(!$isLogin){$login(function(){checkAuthor();this.confirm()}.bind2(this))}else{this.confirm()}}.bind2(this))},confirm:function(){windowDialog.confirm(this.confirm_text,{funcOk:function(){this.clone()}.bind2(this),textOk:"是",textCancel:"否",icon:"03"})},clone:function(){checkAuthor();var url=new Utils.Url(this.save_url);url.setParam("uid",$UID);url.setParam("suid",scope.$uid);url.setParam("tp",this.id);url.setParam("productid",scope.pid_map[scope.$PRODUCT_NAME]);setTimeout(function(){Utils.Io.JsLoad.request(url.toString(),{onComplete:this.parse.bind2(this),charset:"UTF-8"})}.bind2(this),1)},parse:function(result){switch(result.code){case"A00006":windowDialog.alert(this.success_text,{icon:"01",funcOk:function(){var productUrl={blog:"u/",music:"m/",tiezi:"platform/?uid=",icp:"u/",photo:"u/",vblog:"m/"};var url=window.location.protocol+"//"+window.location.host+"/"+productUrl[scope.$PRODUCT_NAME]+$UID;window.location.href=url},textOk:"确定"});break;default:showError(result.code);break}}};App.$hiddenCloneTpl=function(){if($E("idname_1")){$E("idname_1").style.visibility="hidden"}};App.$showCloneTpl=function(){if($E("idname_1")){$E("idname_1").style.visibility="visible"}};$registJob("copy_template",function(){var templateId=config.common.t;var templateConfig=scope.cloneTemplateConfig[templateId];if(templateConfig&&config.common.r!="1"){templateConfig["id"]=templateId;new App.CloneTemplate(templateConfig)}});
Core.Dom.insertAfter=function(newElement,targetElement){var parent=targetElement.parentNode;if(parent.lastChild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}return newElement};
Core.Dom.up=function(element,className){var el=$E(element);while(el.parentNode){if(el.className.indexOf(className)!=-1){return el}el=el.parentNode}};
Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};
Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};
Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};
App.articleCommentManage=Core.Class.create();App.articleCommentManage.prototype={initialize:function(){},del:function(comment_id){this.del_id=comment_id;var del_url=new Interface("http://control.blog.sina.com.cn/admin/comment/comment_del_post.php",$IE6?"ijax":"jsload");var _para={"comment_id":scope.$articleid+"|"+comment_id,"page_id":scope.$comment_page,"uid":$UID};del_url.request({GET:_para,onSuccess:function(_data){$callJob("setNum");this.del_id=null;$refreshComment()}.bind2(this),onError:function(result){trace("删除评论返回状态码："+result.code);showError(result.code)}.bind2(this),onFail:function(){trace("删除失败！请重试。");windowDialog.alert("删除失败！请重试。",{"icon":"02"})}.bind2(this)})},reply:function(comment_id){if($E("replyBody")){return}var _manageBtn=Core.Dom.getElementsByClass($E("cmt_"+comment_id),"a","CP_a_fuc");Core.Array.foreach(_manageBtn,function(e){if(/回复/.test(e.innerHTML)){e.style.display="none"}});this.comment_id=comment_id;var replyBody=$C("div");replyBody.id="replyBody";replyBody.className="CP_cmt_re";replyBody.innerHTML=this.replyStruc;var _comment=$E("cmt_"+comment_id);var reply_container=Core.Dom.getElementsByClass(_comment,"div","CP_item_r")[0];reply_container.appendChild(replyBody);Core.Events.addEvent("reply_comment_button",this.postReply.bind2(this));Core.Events.addEvent("reply_comment_cancel",function(){Core.Dom.removeNode("replyBody");var _manageBtn=Core.Dom.getElementsByClass($E("cmt_"+comment_id),"a","CP_a_fuc");Core.Array.foreach(_manageBtn,function(e){if(/回复/.test(e.innerHTML)){e.style.display=""}})})},postReply:function(){var _reply=new Interface("http://control.blog.sina.com.cn/admin/comment/comment_reply_post.php","ijax");var data={};data.comment_id=this.comment_id;data.reply_content=$E("reply_comment_content").value;if(Core.String.trim(data.reply_content)==""){showError("B36041");return}data.article_id=scope.$articleid;_reply.request({POST:data,onSuccess:function(result){$refreshComment()}.bind2(this),onError:function(result){trace("删除评论返回状态码："+result.code);showError(result.code)}.bind2(this),onFail:function(){trace("回复评论失败");windowDialog.alert("发评论失败！请重试。",{"icon":"02"})}.bind2(this)})},delReply:function(reply_id){this.del_reply_id=reply_id;var del_url=new Interface("http://control.blog.sina.com.cn/admin/comment/comment_del_reply_post.php",$IE6?"ijax":"jsload");var _param={"comment_id":scope.$articleid+"|"+reply_id,"page_id":scope.$comment_page,"uid":$UID};del_url.request({GET:_param,onSuccess:function(result){trace("删除回复成功");$refreshComment();this.del_reply_id=null}.bind2(this),onError:function(result){trace("删除评论返回状态码："+result.code);showError(result.code)}.bind2(this),onFail:function(){trace("删除失败！请重试。");windowDialog.alert("删除失败！请重试。",{"icon":"02"})}})},replyStruc:'<p class="CP_cmt_rettl"><em>回复：</em></p><textarea id="reply_comment_content"></textarea><p class="CP_cmt_resub"><a class="CP_a_btn CP_a_btnsub" href="#" onclick="return false;"><cite id="reply_comment_button">回复</cite><input type="submit" value=""/></a><a class="CP_a_btn" href="#" onclick="return false;"><cite id="reply_comment_cancel">取消</cite></a></p>'};$registJob("article_comment_manage",function(){trace("评论管理类初始化");var _cms=(scope.$isCommentAllow=="1");if(_cms){var $CommentMana=new App.articleCommentManage();del_comment=function(comment_id){windowDialog.confirm($SYSMSG.B36111,{funcOk:function(){$CommentMana.del(comment_id)},textOk:"是",textCancel:"否"})};reply_comment=$CommentMana.reply.bind2($CommentMana);post_reply_comment=$CommentMana.postReply.bind2($CommentMana);del_reply=function(comment_id){windowDialog.confirm($SYSMSG.B36112,{funcOk:function(){$CommentMana.delReply(comment_id)},textOk:"是",textCancel:"否"})}}});
Sina.pkg("Utils.Sinput");
Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return(str.length+(!aMatch?0:aMatch.length))};
Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};
Utils.Sinput.limitMaxLen=function(oTextNode,nMaxLen){var nValue;var keyup=function(){nValue=oTextNode.value;var strLen=Core.String.byteLength(nValue);if(strLen>nMaxLen){oTextNode.value=Core.String.leftB(nValue,nMaxLen)}};Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"keyup");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"blur");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"focus")};
scope.Inter_Login=new Interface("http://icp.cws.api.sina.com.cn/login/login.php","ijax");
Module.Login.post=function(info,callback){info=info||{};callback.onSuccess=callback.onSuccess||callback.onComplete||function(){};callback.onError=callback.onError||function(){};callback.onFail=callback.onFail||function(){};scope.Inter_Login.request({POST:info,onSuccess:function(_data){trace("login succ");callback.onSuccess(_data)},onError:function(_data){trace(_data);callback.onError(_data)},onFail:function(){callback.onFail()}})};
$SYSMSG.extend({"A19002":"登录名和密码不匹配，请重新输入。","A19004":"请输入验证码。","A19005":"验证码错误，请重新输入。","A19006":"请输入登录名。","A19007":"请输入密码。","A19008":"此登录帐户尚未确认。请直接去邮箱进行确认此帐户<br />或<a href=\"http://login.sina.com.cn/hd/resend.php\" target=_blank>重发确认信</a>。","A19009":"登录名不存在，请重新输入。"});
var checkUserProduct={isinit:false,func:null,product:"",flag:true,getReturn:function(name){switch(name){case"blog":var tmp=("0x"+scope.userProducts[$UID])&0x00000001;trace("tmp="+tmp);if(tmp!=0){this.flag=true}else{this.flag=false}break;case"photo":var tmp=("0x"+scope.userProducts[$UID])&0x00000008;if(tmp!=0){this.flag=true}else{this.flag=false}break;default:this.flag=true}this.func()},check:function(name,func){this.product=name;this.func=func||function(){};if(scope.userProducts){this.getReturn(name)}else{var url="http://uic.sinajs.cn/uic?type=service&uids="+$UID;Utils.Io.JsLoad.request(url,{onComplete:function(result){trace("读取用户产品信息");trace(result[$UID]);scope.userProducts=result;this.getReturn(this.product);this.isinit=true}.bind2(this),charset:"UTF-8"})}}};
App.articleCommentPost=Core.Class.create();App.articleCommentPost.prototype={initialize:function(loginStatus){if(loginStatus){trace("登陆了");this.displayLoginInfo()}else{$E("comment_anonyous").value="新浪网友";$E("comment_anonyous").disabled=true;$E("comment_anon").style.display="none"}Core.Events.addEvent("comment_post_btn",this.post.bind2(this));Core.Events.addEvent("comment_check_img",this.refreshCheckImg.bind2(this));Core.Events.addEvent("anonymity",function(){if($E("anonymity").checked){$E("comment_anonyous").value="新浪网友";$E("comment_anon").style.display="";var o=$E("login_name").parentNode.parentNode.childNodes;var count=0;for(var i=0;i<o.length&&count<4;i++){if(o[i].tagName=="LI"){o[i].style.display="none";count++}}}else{$E("comment_anon").style.display="none";var o=$E("login_name").parentNode.parentNode.childNodes;var count=0;for(var i=0;i<o.length&&count<4;i++){if(o[i].tagName=="LI"){o[i].style.display="";count++}}}});Core.Events.addEvent("comment_get_vcode",this.refreshCheckImg);Utils.Sinput.limitMaxLen($E("comment_anonyous"),16);var _this=this;Core.Events.addEvent($E("login_check"),function(){$E("comment_check_img").style.display="";if($E("comment_check_img").src==""){if($E("check_show")){$E("check_show").style.display="none"}_this.refreshCheckImg()}},"focus");Core.Events.addEvent($E("commentArea"),function(){$E("comment_check_img").style.display="";if($E("comment_check_img").src==""){if($E("check_show")){$E("check_show").style.display="none"}_this.refreshCheckImg()}},"focus");var flag=config["private"].hidecms|(typeof(article_hidecms)!="undefined"?article_hidecms:0);if(flag==0&&!loginStatus){$E("cmt_hide").style.display=""}else{$E("cmt_hide").style.display="none"}},$ArticlePerPage:50,displayLoginInfo:function(){trace("displayLoginInfo");var o=$E("login_name").parentNode.parentNode.childNodes;var count=0;for(var i=0;i<o.length&&count<6;i++){if(o[i].tagName=="LI"){o[i].style.display="none";count++}}$E("comment_wel").style.display="";var showNickPlace=function(){if(checkUserProduct.flag==true){scope.setNickTime=setInterval(function(){if(typeof scope.$loginNick=='undefined'){Utils.Uic.getNickName([$UID],function(oResult){for(var key in oResult){scope.$loginNick=oResult[key];$E("comment_wel").innerHTML='<li class="CP_cmt_nm_d">'+scope.$loginNick+':</li>'}});clearInterval(scope.setNickTime)}else{$E("comment_wel").innerHTML='<li class="CP_cmt_nm_d">'+scope.$loginNick+':</li>'}},500)}else{$E("comment_wel").innerHTML='<li class="CP_cmt_nm_d">您还未<a href="http://login.sina.com.cn/hd/reg.php?entry=blog">开通</a>博客，只能匿名发表评论。</li>'}};if(checkUserProduct.isinit==false){window.checkuserinterval=setInterval(function(){if(checkUserProduct.isinit==false){checkUserProduct.check("blog",showNickPlace)}else{clearInterval(window.checkuserinterval)}},500)}else{showNickPlace()}},refreshCheckImg:function(){$E("comment_check_img").src="http://vlogin.blog.sina.com.cn/myblog/checkwd_image.php?"+new Date().valueOf()},post:function(){var data;if($isLogin){if(this.checkLogin()){data={};data.fromtype="commentadd";data.comment=$E("commentArea").value;data.article_id=scope.$articleid;data.uid=$UID;data.check=$E("login_check").value;data.stamp=new Date().valueOf();this.postComm(data)}}else{if(this.checkNoLogin()){data={};data.fromtype="commentadd";data.anonymity=$E("anonymity").checked?true:false;data.comment=$E("commentArea").value;data.article_id=scope.$articleid;data.check=$E("login_check").value;if(data.anonymity){trace("匿名评论发表");$E("comment_anon").style.dispaly="";data.login_name=$E("comment_anonyous").value;this.postComm(data)}else{var logininfo={};logininfo.loginname=$E("login_name").value;logininfo.loginpwd=$E("login_pass").value;logininfo.check_word=$E("login_check").value;logininfo.productid=scope.pid_map["blog"];logininfo.clean_vcode="1";Module.Login.post(logininfo,{onSuccess:function(_code){trace("登录成功，开始提交评论数据");checkAuthor();data.uid=$UID;this.displayLoginInfo();this.postComm(data);SinaSysTray.refresh("sinatopbar",{type:"blog"||"",uid:$UID||"0"})}.bind2(this),onError:function(_code){if(_code!=null&&typeof _code.code!="undefined"&&_code.code!="B36998"){showError(_code.code);this.refreshCheckImg();return}}.bind2(this),onFail:function(){}})}}}},postComm:function(data){var _url=new Interface("http://control.blog.sina.com.cn/admin/comment/comment_post.php","ijax");_url.request({POST:data,onSuccess:function(result){scope.$totalCommentsNum++;if($E("c_"+scope.$articleid)!=null){$E("c_"+scope.$articleid).innerHTML='('+scope.$totalCommentsNum+')'}scope.$comment_page=Math.ceil(scope.$totalCommentsNum/this.$ArticlePerPage);window.$cmtAnchor=result.msg;$refreshComment();this.refreshCheckImg();$E("commentArea").value="";$E("login_check").value=""}.bind2(this),onError:function(_result){if(_result.code=="B36998"){}else{showError(_result.code);this.refreshCheckImg()}}.bind2(this),onFail:function(){trace("post comment error");windowDialog.alert("发评论失败！请重试。",{"icon":"02"})}.bind2(this)})},checkLogin:function(){if(Core.String.trim($E("commentArea").value)==""){showError("B36105");return false}if(Core.String.trim($E("login_check").value)==""){showError("B36106");return false}return true},checkNoLogin:function(){if($E("anonymity").checked){if(Core.String.trim($E("comment_anonyous").value)==""){showError("B36003");return false}}else{if(Core.String.trim($E("login_name").value)==""){showError("B36107");return false}if(Core.String.trim($E("login_pass").value)==""){showError("B36108");return false}}return this.checkLogin()}};$registJob("article_comment_post",function(){trace("发表评论类初始化");var _cms=(scope.$isCommentAllow=="1");if(_cms){var $CommentPost=new App.articleCommentPost($isLogin)}});
App.RandomStroll=Core.Class.create();App.RandomStroll.prototype={swf_url:"http://simg.sinajs.cn/common/swf/rndView.swf",initialize:function(){var div=$C("div");div.id="ramdomVisitDiv";div.style.position="absolute";div.style.top="43px";div.style.width="100px";document.body.appendChild(div);this.div=div;this.lock();Core.Events.addEvent(window,function(){this.lock()}.bind2(this),"resize");Core.Events.addEvent(window,function(){this.lock()}.bind2(this),"scroll")},load:function(option){Utils.Flash.swfView.Add(this.swf_url,"ramdomVisitDiv","map","100","120","8.0.0.0","#000",option,{scale:"noscale",allowScriptAccess:"always",wmode:"transparent"})},lock:function(){var w=Core.System.pageSize()[2];this.div.style.right="0px"},show:function(){$E("ramdomVisitDiv").style.display=""},hide:function(){$E("ramdomVisitDiv").style.display="none"}};App.RandomStroll.getRandomURL=function(url,link_url,rand,isSendLog){var id=Math.floor(Math.random()*992);Utils.Io.JsLoad.request(url,{onComplete:function(){var tm=Math.floor(Math.random()*uidlist.length);var uid=uidlist[tm];window.location.href=link_url+"/u/"+uid},noreturn:true});if(isSendLog)v5SendLog("ffk","index")};App.RandomStroll.GoUrlByConfig={go:function(cnf){if(cnf&&cnf.length){var length=cnf.length;for(var i=0;i<length;i++){this.randomByProbability(cnf[i].probability,cnf[i].url)}}},randomByProbability:function(probability,url){var num=Boot.getRandomNum(1,probability);if(num==1){window.location.href=url}}}
$registJob("randomStroll",function(){var randomTime=new Date().getTime();var link_url="http://blog.sina.com.cn";var url_4_blog="http://blog.sina.com.cn/myblog/rankuidview.php?time="+randomTime;var rand=new App.RandomStroll();rand.load({target:"_self",URL:""});Core.Events.addEvent("ramdomVisitDiv",function(){App.RandomStroll.GoUrlByConfig.go(scope.blog_randomstroll_config);App.RandomStroll.getRandomURL(url_4_blog,link_url,rand,true);v6SendLog("blog","ramdomVisit","click")},"mousedown");Core.Events.addEvent("map",function(){Core.Events.stopEvent();v6SendLog("blog","ramdomVisit","mouseOver")},"mouseover")});
Module.AudioCheck={};Module.AudioCheck.swfUrl="http://simg.sinajs.cn/common/swf/mp3.swf";Module.AudioCheck.render=function(target,soundUrl){$E(target).innerHTML='<a style="margin-left:3px;" href="javascript:Module.AudioCheck.callAudioCheck();">收听验证码</a><img id="play_img" name="play_img" src="http://image2.sina.com.cn/blog/tmpl/v3/images/blank.gif" align="absmiddle" style="margin-right:2px;" height="15"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0" width="0" height="0" id="mp3_player" align="middle"><param name="allowScriptAccess" value="always" /><param name="movie" value="'+this.swfUrl+'" /><param name="quality" value="high" /><param name="bgcolor" value="#ffffff" /><param name="FlashVars" value="mp3URL='+soundUrl+'" /><embed src="'+this.swfUrl+'" FlashVars="mp3URL='+soundUrl+'" quality="high" bgcolor="#ffffff" width="0" height="0" name="mp3_player" swLiveConnect="true" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer"/></object>'};Module.AudioCheck.callAudioCheck=function(){setTimeout(function(){$E('play_img').src='http://blogimg.sinajs.cn/v5images/play_img.gif';window.document.mp3_player.SetVariable("isPlay","1");$E('login_check').value='';$E('login_check').focus()},500)};
$registJob("audio_check",function(){var cont=$E("audioCheckCont");var blog_sound_url="http://icp.cws.api.sina.com.cn/login/login_audio.php";if(cont){Module.AudioCheck.render(cont,blog_sound_url)}});
scope.getSearchReferrer=function(){var o={};var docURL=document.URL;if(docURL.indexOf("blog.sina.com.cn")!=-1&&docURL.indexOf("k=")!=-1){var u=new Utils.Url(docURL);o.key=u.getParam("k");o.type=u.getParam("t");return o}var refer=document.referrer;if(!refer||refer===""){return false}var searchParam={"www.google.com":{param:"q",type:"utf-8"},"www.google.cn":{param:"q",type:"utf-8"},"www.baidu.com":{param:"wd",type:"GBK"},"www.soso.com":{param:"w",type:"GBK"},"cn.yahoo.com":{param:"p",type:"utf-8"},"search.yahoo.com":{param:"p",type:"utf-8"},"gougou.com":{param:"search",type:"utf-8"},"cn.bing.com":{param:"q",type:"utf-8"},"www.youdao.com":{param:"q",type:"utf-8"},"www.sogou.com":{param:"query",type:"GBK"},"yisou.com":{param:"search",type:"utf-8"},"uni.sina.com.cn":{param:"k",type:"gbk"}};for(var k in searchParam){if(refer.indexOf("yisou.com/search:")!=-1){o.key=refer.split("search:")[1];o.type="utf-8";break}var url=new Utils.Url(refer);if(refer.indexOf("uni.sina.com.cn")!=-1&&refer.indexOf("ie=")!=-1){o.key=url.getParam("k");o.type=url.getParam("ie");break}if(refer.indexOf(k)!=-1){o.key=url.getParam(searchParam[k]["param"]);o.type=searchParam[k]["type"];break}}if(!o.key||o.key===""){return false}else{return o}};
$registJob("outSearch",function(){var dataURL='http://keyword.sina.com.cn/blogrelated/combinedqueryBPV_utf8.php';var key="";var type="GBK";var container=null;var ch=83;var mainTemplate='<div class="searchFloatout">'+'<div class="searchFlot">'+'<div class="sFlot914">'+'<div class="flotFirst">'+' <div class="firstLeft" id="out_topTitle"> </div>'+' <div class="firstRight" id="out_rightTitle"> </div>'+' </div>'+' <div class="floatSecond" id="out_content">'+'</div>'+'</div>'+'<div  class="searchX" ><a  href="###"  id="searchXID"><img src="http://simg.sinajs.cn/blog/images/searchx.gif" /></a></div>'+' </div>'+'<div class="searhBottom"></div>'+'<iframe width="100%" height="83" style="position:absolute; top:0px; z-index:-1;"></iframe>';var contentTemplate=' <ul class="secondLeft">#{titleTxt}</ul>'+'<ul class="secondRight">'+'<li>'+'  <div class="rightImg">#{photoImg}</div>'+' <div class="rightWord">#{photoTxt} </div>'+'</li>'+'<li>'+'<div class="rightImg">#{videoImg}</div>'+'<div class="rightWord">#{videoTxt}</div>'+' </li>'+'</ul>';var loadingTemplate='<div class="loatReading">读取中...</div>';var errorTemplate='<div class="interErro"><a href="http://uni.sina.com.cn/" target="_blank">网络问题，请点击此处重新获取内容</a></div>';var hotTitleTemplate='<h3>近期热点内容推荐：</h3>';var titleTemplate='关于“<strong><a href="#" title="#{title}">#{content}</a></strong>”的更多内容：';var animate=function(target,prop,from,to,step){step=step?step:2;target.style[prop]=from+"px";var loop=function(){var tt=parseInt(target.style[prop]);if(tt<=to+Math.abs(step)&&tt>=to-Math.abs(step)){target.style[prop]=to+"px"}else{target.style[prop]=(tt+step)+"px";setTimeout(loop,30)}};loop()};var getStrLen=function(str,n){var tmpStr=str.substr(0,n);var tmpCode=tmpStr.replace(/[^\x00-\xff]/g,'\r\n').split('');n=(tmpCode[n-1]=='\r')?n-2:n-1;var l=tmpCode.slice(0,n).join('').replace(/\r\n/g,'*').length+1;return tmpStr.substr(0,l)};var init=function(){var ref=scope.getSearchReferrer();if(!ref){return}else{key=ref.key;type=ref.type}Core.Events.addEvent(window,initContainer,"scroll",false)};var onGetContentError=function(){$E("out_content").innerHTML=errorTemplate};var onGetContentSucess=function(res){var info={};var titleTxt_s="";var len=res.data.b.length>6?6:res.data.b.length;for(var i=0;i<len;i++){var temp_s='<li><a  href="'+res.data.b[i].l+"?k="+encodeURIComponent(res.data.k)+"&t="+"utf-8"+'" title="'+res.data.b[i].f+'" target="_blank" onclick="v6SendLog(\'blog\', \'search\', \'article\');">'+res.data.b[i].t+'</a></li>';titleTxt_s+=temp_s}info.titleTxt=titleTxt_s;var photoData=res.data.p[0];if(photoData){var photoImgTemp='<a onclick="v6SendLog(\'blog\', \'search\', \'photo\');" href="'+photoData.l+'" target="_blank" title="'+photoData.f+'"><img src="'+photoData.i+'" width="51" height="38" alt="'+photoData.f+'" /></a>';info.photoImg=photoImgTemp;var photoTxtTemp='<a  onclick="v6SendLog(\'blog\', \'search\', \'photo\');" href="'+photoData.l+'" target="_blank" class="CP_a_fuc">[<cite>图片</cite>]</a><em><a onclick="v6SendLog(\'blog\', \'search\', \'photo\');" href="'+photoData.l+'" target="_blank" class="wordCont" title="'+photoData.f+'">'+photoData.t+'</a></em>';info.photoTxt=photoTxtTemp}var videoData=res.data.v[0];if(videoData){var videoImgTemp='<a  onclick="v6SendLog(\'blog\', \'search\', \'video\');" href="'+videoData.l+'" target="_blank" title="'+videoData.f+'"><img src="'+videoData.i+'" width="51" height="38" alt="'+videoData.f+'" /></a>';info.videoImg=videoImgTemp;var videoTxtTemp='<a onclick="v6SendLog(\'blog\', \'search\', \'video\');" href="'+videoData.l+'" target="_blank" class="CP_a_fuc">[<cite>视频</cite>]</a><em><a  onclick="v6SendLog(\'blog\', \'search\', \'video\');"  href="'+videoData.l+'" target="_blank" class="wordCont" title="'+videoData.f+'">'+videoData.t+'</a></em> ';info.videoTxt=videoTxtTemp}contentTemplate=new Utils.Template(contentTemplate).evaluate(info);$E("out_content").innerHTML=contentTemplate;if(res.code=="A09000"){$E("out_topTitle").innerHTML=hotTitleTemplate}else{var titleLink="http://uni.sina.com.cn/c.php?k="+encodeURIComponent(res.data.k)+"&t=all&ie=utf-8";$E("out_topTitle").innerHTML='<span>关于“</span><strong><a onclick="v6SendLog(\'blog\', \'search\', \'keywords\');" href="'+titleLink+'" target="_blank" title="'+res.data.k+'">'+res.data.ks+'</a></strong><span>”的更多内容：</span>'}};var getContent=function(){if(!/^(%[abcdef0-9]{2})/gi.test(key)){type="utf-8"}var _io=Utils.Io.JsLoad.request(dataURL,{GET:{"type":type,"varname":"outSearch_data","keyword":key},charset:"utf-8",onComplete:(function(result){if(result&&result.data&&(result.code=="A00006"||result.code=="A09000")){onGetContentSucess(result)}else{}}).bind2(this),onException:(function(){onGetContentError()}).bind2(this)})};var quit=function(){v6SendLog("blog","search","close");document.body.removeChild(container);Core.Events.removeEvent(window,initContainer,"scroll");return false};var initContainer=function(){var show=function(){if(!$IE6){container.style.position="fixed";animate(container,"top",document.documentElement.clientHeight,document.documentElement.clientHeight-83,-10)}else{container.style.position="absolute";container.style.top=document.documentElement.clientHeight+document.documentElement.scrollTop-83+"px"}};var initContent=function(){var right=scope.blog_outSearchTitle;if(right){var temps="";for(var i=0,len=right.length;i<len;i++){var s='<span><a onclick="v6SendLog(\'blog\', \'search\', \'advertisement\')" href="'+right[i].link+'" target="_blank">'+right[i].title+'</a></span>';temps+=s}$E("out_rightTitle").innerHTML=temps}$E("out_content").innerHTML=loadingTemplate};if(!container){if(Math.max(document.documentElement.scrollTop,document.body.scrollTop)>250){container=$C("div");container.style.left="0px";container.style.zIndex=100001;container.style.width="100%";container.innerHTML=mainTemplate;document.body.appendChild(container);Core.Events.addEvent($E("searchXID"),quit,"click",false);show();initContent();getContent();v6SendLog("blog","search","display")}}else{if($IE6){container.style.top=document.documentElement.clientHeight+document.documentElement.scrollTop-83+"px"}}};init()});
App.FlashTemplate=function(template_id){var tpl_cfg1=scope.flash_template_config[template_id];if(typeof tpl_cfg1!='undefined'){Utils.Flash.swfView.Add(tpl_cfg1.swf,"toppicflash","map1",tpl_cfg1.width,tpl_cfg1.height,"8.0.0.0","#000",{},{scale:"noscale",allowScriptAccess:"always",wmode:"transparent"})}};$registJob("flash_template",function(){var template;if(config.common.t=="13_0"){template=scope.theme_id}else{template=config.common.t}App.FlashTemplate(template)});
$registJob("updownurl",function(){if($E("nextprev_"+scope.$articleid)){var cont=$E("nextprev_"+scope.$articleid);var inter=new Interface("http://blogtj.sinajs.cn/api/get_prevnext_article.php","jsload");var time=$E("t_"+scope.$articleid).nextSibling.innerHTML.replace("(","").replace(")","");inter.request({GET:{uid:scope.$uid,blog_id:scope.$articleid,varname:"prevnext",blog_pubdate:time},onSuccess:function(result){var html="";if(result.prev!=null){html+='前一篇：<span class="space6"></span><a href="'+result.prev.blog_url+'" >'+result.prev.blog_title+'</a><br />'}if(result.next!=null){html+='后一篇：<span class="space6"></span><a href="'+result.next.blog_url+'" >'+result.next.blog_title+'</a>'}cont.innerHTML=html},onError:function(){},onFail:function(){}})}});
$registJob("shareminiblog",function(){if($E('shareminiblogfromblogatarticlepage')){var x="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?',u=z||d.location,p=['url=',e(u),'&title=',e(t||d.title),'&source=',e(r),'&sourceUrl=',e(l),'&content=',c||'gb2312','&pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'新浪-博客','http://blog.sina.com.cn','"+(scope.$album_pic?scope.$album_pic:'')+"','分享"+scope.nick[scope.$uid]+"的博文："+$E("t_"+scope.$articleid).innerHTML+"','http://blog.sina.com.cn/s/blog_"+scope.$articleid+".html','utf-8'));";$E('shareminiblogfromblogatarticlepage').href=x}});
function main(){var job=new Jobs();job.add("nav");job.add("comp_render903");job.add("comp_render909");job.add("init_loginUI");job.add("setTitle");job.add("randomStroll");job.add("flash_template");job.add("outSearch");job.add("updownurl");job.start()}function exeute(){var job=new Jobs();job.add("setNum");job.add("comp_render");job.add("article_comment_load");job.add("audio_check");job.add("article_comment_manage");job.add("comment_insertSmile");job.add("article_comment_post");job.add("renderAd");job.add("showSubscription");job.add("copy_template");job.add("shareminiblog");job.start()}
